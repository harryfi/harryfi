@using System.Globalization
@using MasterOnline.ViewModels
@model BundlingViewModel
@{
    var dataSession = Session["SessionInfo"] as AccountUserViewModel;
    var username = "";
    if (dataSession?.User != null)
    {
        var context = new MoDbContext("");
        var accId = context.User.Single(u => u.Email == dataSession.User.Email).AccountId;
        username = context.Account.Single(a => a.AccountId == accId).Username;
        context.Dispose();
    }
    else
    {
        username = dataSession?.Account.Username;
    }
    if (username.Length > 20)
    {
        username = username.Substring(0, 17) + "...";
    }
}
<style>
    .nbrg-class {
        box-shadow: inset 0 1px 0 rgba(0,0,0,.075);
        border-radius: 25px 0 0 25px;
        border: 1px solid rgba(221,226,232,.49);
        border-radius: 0;
        width: 100%;
        text-align: left !important;
    }

        .nbrg-class:focus {
            border: 1px solid rgba(221,226,232,.49);
            border-right: 0;
            border-color: #CCD0D7;
            box-shadow: none !important
        }
</style>

<script type="text/javascript">
    $(document).ready(function () {
        Initialize();
    });

    $(".harga-num-only").on('keydown',
        function (e) {
            // Allow: backspace, delete, tab, escape, enter and .
            if ($.inArray(e.keyCode, [46, 8, 9, 27, 13, 110, 190]) !== -1 ||
                // Allow: Ctrl+A, Command+A
                (e.keyCode === 65 && (e.ctrlKey === true || e.metaKey === true)) ||
                // Allow: home, end, left, right, down, up
                (e.keyCode >= 35 && e.keyCode <= 40)) {
                // let it happen, don't do anything
                return;
            }
            // Ensure that it is a number and stop the keypress
            if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {
                e.preventDefault();
            }
        });
    $(".harga-num-only").on('blur',
        function (e) {
            if ($(this).val().trim() == '') {
                $(this).val(0);
            }
        });
</script>
<div>
    <div class="col-md-12 col-sm-12 col-xs-12">
        @*<div class="x_panel">*@
        <div class="">
            @*<div class="x_title">
            <h2 style="font-size: 16px">Form Multi SKU</h2>
            <ul class="nav navbar-right panel_toolbox">
                <li>
                    @*<a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                </li>
            </ul>
            <div class="clearfix"></div>
        </div>*@
            <div class="form-horizontal">
                <div class="">
                    <br>
                    <div class="form-group">
                        @Html.LabelFor(m => m.Bundling.Unit, "Kode Barang Bundling *", new { @class = "control-label col-md-3 col-sm-3 col-xs-12" })
                        <div class="col-md-6 col-sm-6 col-xs-12">
                            <div class="input-group">
                                <span class="input-group-btn">
                                    @Html.TextBoxFor(m => m.Bundling.Unit, new { @class = "form-control", maxlength = 20, @data_val_length_max = 20, required = "required", style = "width: 445px !important", @readonly = "readonly" })
                                    @if (Model.Bundling == null)
                                    {
                                        <button id="brg-bundling" class="btn btn-default" style="margin-right:0px" type="button" onclick="promptBarangBundling()">
                                            <span class="glyphicon glyphicon-option-horizontal"></span>
                                        </button>
                                    }
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        @Html.Label("Nama Barang Bundling *", new { @class = "control-label col-md-3 col-sm-3 col-xs-12" })
                        <div class="col-md-6 col-sm-6 col-xs-12">
                            <div>
                                @*@Html.TextBox("nama-acuan", "", new { @class = "form-control", maxlength = 30, @disabled = "disabled" })*@
                                @if (Model.Brg_Bundling != "" && Model.Brg_Bundling != null)
                                {
                                    var namaBrgBundling = Model.listDetailBundling.Where(a => a.BRG == Model.Brg_Bundling).SingleOrDefault().NAMA + ' ' + Model.listDetailBundling.Where(a => a.BRG == Model.Brg_Bundling).SingleOrDefault().NAMA2;
                                    @Html.TextArea("nama-Bundling", namaBrgBundling, new { @class = "form-control col-md-12 col-sm-12 col-xs-12", style = "resize: none; overflow-y: scroll; height: 80px; width: 100%;", @disabled = "disabled" })
                                }
                                else
                                {
                                    @Html.TextArea("nama-Bundling", new { @class = "form-control col-md-12 col-sm-12 col-xs-12", style = "resize: none; overflow-y: scroll; height: 80px; width: 100%;", @disabled = "disabled" })
                                }
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        @Html.Label("", "Harga Bundling *", new { @class = "control-label col-md-3 col-sm-3 col-xs-12" })
                        <div class="col-md-6 col-sm-6 col-xs-12">
                            <div class="input-group">
                                <span class="input-group-btn">
                                    @{
                                        var TotalHeader = 0d;
                                        if (Model.listBundling.Count() > 0)
                                        {
                                            foreach (var detail in Model.listBundling)
                                            {
                                                if (detail?.TOTALHARGA != null && detail?.TOTALHARGA > 0)
                                                {
                                                    TotalHeader += Convert.ToDouble(detail.TOTALHARGA);
                                                }
                                            }
                                        }
                                    }
                                    @Html.TextBox("harga-Bundling", TotalHeader, new { @class = "form-control harga-num-only", style = "width: 445px !important", @readonly = "readonly", Value = (TotalHeader >= 0 ? String.Format(CultureInfo.CreateSpecificCulture("id-id"), "{0:N}", TotalHeader) : "0,00") })
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        @Html.Label("", "Qty Bundling *", new { @class = "control-label col-md-3 col-sm-3 col-xs-12" })
                        <div class="col-md-6 col-sm-6 col-xs-12">
                            <div class="input-group">
                                <span class="input-group-btn">
                                    @{
                                        var qtyBundling = 0d;
                                        if (Model.Qty_Bundling > 0 && Model?.Qty_Bundling != null)
                                        {
                                            qtyBundling = Model.Qty_Bundling;
                                        }
                                    }
                                    @Html.TextBox("qty-Bundling", qtyBundling, new { @class = "form-control harga-num-only", style = "width: 445px !important", @readonly = "readonly", Value = qtyBundling })
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            @*<br />*@
            <hr />
            @Html.HiddenFor(m => m.Bundling.KOMPONEN_PECAH, new { Value = false })
            @Html.HiddenFor(m => m.Bundling.MEMORY, new { Value = false })
            @Html.HiddenFor(m => m.Bundling.QTY_SIAPJUAL, new { Value = 0 })
            @Html.HiddenFor(m => m.Bundling.QTY_KOMPONEN, new { Value = 0 })
            <div class="form-horizontal">
                @*<div>
                <div class="clearfix"></div>
                <br />
                <br />
                <br />
            </div>
            <div class="x_title">
                <h2 style="font-size: 16px">Multi SKU</h2>
                <ul class="nav navbar-right panel_toolbox">
                    <li>
                        @*<a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                    </li>
                </ul>
                <div class="clearfix"></div>
            </div>*@
                <div class="">
                    <br>
                    <table id="table_tambah_komponen" class="table table-bordered" role="grid">
                        <thead>
                            <tr>
                                <th style="width: 150px !important; max-width: 150px !important;padding:5px !important">Kode Barang Komponen</th>
                                <th width="250px">Nama Barang Komponen</th>
                                <th width="40px">Qty</th>
                                <th width="100px">Harga Jual</th>
                                <th width="100px">Total Harga</th>
                                <th width="40px">Simpan</th>
                                <th width="40px">Hapus</th>
                            </tr>
                        </thead>
                        <tbody>
                            @{
                                var listBarang = Model.listDetailBundling.ToList();
                                var iPd = 0;
                            }
                            @foreach (var sku_bundling in Model.listBundling.Where(pb => pb.Unit == Model?.Brg_Bundling).ToList())
                            {
                                <tr data-barang-id="brg-@sku_bundling.Brg">
                                    <td style="width: 150px !important; max-width: 150px !important;padding:5px !important">
                                        @sku_bundling.Brg
                                    </td>
                                    <td class="nama-barang">
                                        @{
                                            var nm = "";
                                            var nm2 = "";
                                            if (listBarang.SingleOrDefault(b => b.BRG == sku_bundling.Brg) != null)
                                            {
                                                nm = listBarang.SingleOrDefault(b => b.BRG == sku_bundling.Brg).NAMA;
                                                nm2 = listBarang.SingleOrDefault(b => b.BRG == sku_bundling.Brg)?.NAMA2;
                                            }
                                        }
                                        @nm @nm2
                                    </td>
                                    <td class="qty-barang">@sku_bundling.Qty</td>
                                    <td class="harga-barang">@sku_bundling.HARGA</td>
                                    <td class="total-harga">@sku_bundling.TOTALHARGA</td>
                                    <td class="edit-hapus-col">
                                        <button type="button" class="btn btn-primary" disabled="disabled">
                                            <span class="glyphicon glyphicon-floppy-disk" aria-hidden="true"></span>
                                        </button>
                                    </td>
                                    <td class="edit-hapus-col">
                                        <button class="btn btn-danger" type="button" onclick="deleteDetailKomponenKlik('@sku_bundling.Brg','@sku_bundling.Unit')">
                                            <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
                                        </button>
                                    </td>
                                </tr>
                                iPd = iPd + 1;
                            }
                            <tr data-barang-id="0">
                                @Html.HiddenFor(m => m.Bundling.No)
                                @Html.HiddenFor(m => m.Bundling.TGL_EDIT, new { Value = DateTime.Now.ToString("dd/MM/yyyy") })
                                <td style="width: 150px !important; max-width: 150px !important;padding:5px !important">
                                    @Html.TextBoxFor(m => m.Bundling.Brg, new { @readonly = "readonly", placeholder = "Pilih Barang", @style = "background-color : #eee; cursor :not-allowed; height: 34px; width: 140px !important; ; margin-right:0px", @class = "nbrg-class" })
                                    <button id="tambah-brg" class="btn btn-default" type="button" style="height: 34px;margin:0px;width:25px !important;padding:unset" onclick="promptBarangKomponen()">
                                        <span class="glyphicon glyphicon-option-horizontal center-block"></span>
                                    </button>
                                </td>
                                @*<td style="width: 150px; max-width: 150px;">
                                <div id="BRG" class="selectivity-input" tabindex="0"></div>
                                @Html.HiddenFor(m => m.BarangStok.Kobar)
                            </td>*@
                                <td class="nama-barang">-</td>
                                <td class="qty-barang">
                                    0
                                    @Html.HiddenFor(m => m.Bundling.Qty)
                                </td>
                                <td class="harga-barang" style="text-align:right">
                                    0,00
                                    @Html.HiddenFor(m => m.Bundling.HARGA)
                                </td>
                                <td class="total-barang" style="text-align:right">
                                    0,00
                                    @Html.HiddenFor(m => m.Bundling.TOTALHARGA)
                                </td>
                                <td class="edit-hapus-col">
                                    <button type="button" class="btn btn-primary" disabled="disabled" onclick="simpanKomponen()">
                                        <span class="glyphicon glyphicon-floppy-disk" aria-hidden="true"></span>
                                    </button>
                                </td>
                                <td class="edit-hapus-col">
                                    <button class="btn btn-danger" disabled="disabled">
                                        <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
@*<button type="button" id="simpan_btn" class="btn btn-primary pull-right" onclick="simpanPiutang(this);">Simpan</button>*@
