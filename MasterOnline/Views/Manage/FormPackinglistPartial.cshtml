@using System.Globalization
@using MasterOnline.ViewModels

@model PackingListViewModel

@Html.HiddenFor(m => m.packingList.RecNum)

<style>
    @@media screen and (max-width: 445px) {
        .brgtblpromofrm {
            width: 42%;
        }
    }

    @@media screen and (max-width: 375px) {
        .brgtblpromofrm {
            width: 34%;
        }
    }

    @@media screen and (max-width: 325px) {
        .brgtblpromofrm {
            width: 28%;
        }
    }
</style>

<script type="text/javascript">
    $(document).ready(function () {
        Initialize();
        RefreshSemuaPesananMP();
    });

    function RefreshSemuaPesananMP() {
        RefreshPackingPesananTokped();
        RefreshPackingPesananLazada();
        RefreshPackingPesananShopee();
        RefreshPackingPesananBlibli();
    }

    function RefreshPackingPesananTokped() {
        var $link = '@Html.Raw(Url.Action("RefreshTablePackingPesananMP", "Manage", new { nama_cust="15", bukti = "replaceBuktiPacking" }))';
        $link = $link.replace("replaceBuktiPacking", encodeURIComponent($('#packingList_NO_BUKTI').val()));

        $.ajax({
            type: "GET",
            url: $link,
            beforeSend: function () {
                //$('#loading_barang_tab').show();
            },
            success: function (response) {
                $('#packing_pesanan_tokped_content').html(response);
                //$('#loading_barang_tab').hide();
            },
            error: function (xhr, status, error) {
                console.log(error);
            }
        });
    }
    function RefreshPackingPesananLazada() {
        var $link = '@Html.Raw(Url.Action("RefreshTablePackingPesananMP", "Manage", new { nama_cust = "7", bukti = "replaceBuktiPacking" }))';
        $link = $link.replace("replaceBuktiPacking", encodeURIComponent($('#packingList_NO_BUKTI').val()));

        $.ajax({
            type: "GET",
            url: $link,
            beforeSend: function () {
                //$('#loading_barang_tab').show();
            },
            success: function (response) {
                $('#packing_pesanan_lazada_content').html(response);
                //$('#loading_barang_tab').hide();
            },
            error: function (xhr, status, error) {
                console.log(error);
            }
        });
    }

    function RefreshPackingPesananShopee() {
        var $link = '@Html.Raw(Url.Action("RefreshTablePackingPesananMP", "Manage", new { nama_cust = "17", bukti = "replaceBuktiPacking" }))';
        $link = $link.replace("replaceBuktiPacking", encodeURIComponent($('#packingList_NO_BUKTI').val()));

        $.ajax({
            type: "GET",
            url: $link,
            beforeSend: function () {
                //$('#loading_barang_tab').show();
            },
            success: function (response) {
                $('#packing_pesanan_shopee_content').html(response);
                //$('#loading_barang_tab').hide();
            },
            error: function (xhr, status, error) {
                console.log(error);
            }
        });
    }
    function RefreshPackingPesananBlibli() {
        var $link = '@Html.Raw(Url.Action("RefreshTablePackingPesananMP", "Manage", new { nama_cust = "16", bukti = "replaceBuktiPacking" }))';
        $link = $link.replace("replaceBuktiPacking", encodeURIComponent($('#packingList_NO_BUKTI').val()));

        $.ajax({
            type: "GET",
            url: $link,
            beforeSend: function () {
                //$('#loading_barang_tab').show();
            },
            success: function (response) {
                $('#packing_pesanan_blibli_content').html(response);
                //$('#loading_barang_tab').hide();
            },
            error: function (xhr, status, error) {
                console.log(error);
            }
        });
    }
    
</script>
<div class="form-horizontal">
    <div class="row">
        <div class="col-md-6">
            <div class="form-group">
                @Html.LabelFor(m => m.packingList.NO_BUKTI, "No. Bukti", new { @class = "col-md-4 col-sm-4 col-xs-12 control-label" })
                <div class="col-md-6 col-sm-6 col-xs-12">
                    @Html.HiddenFor(m => m.packingList.NO_BUKTI)
                    @if (Model.packingList != null)
                    {
                        <input type="text" value="@Model.packingList.NO_BUKTI" disabled class="form-control" />
                    }
                    else
                    {
                        <input type="text" value="[AUTO]" disabled class="form-control" />
                    }
                </div>
            </div>
        </div>
        @*<div class="col-md-6">
                <div class="form-group">
                    <div class="col-md-6 col-sm-6 col-xs-1"></div>
                    <div class="col-md-6 col-sm-6 col-xs-11">
                        @if (Model.listRekapBarang.Count > 0)
                        {
                            <button id="btnPrint" type="button" class="btn btn-primary" data-toggle="modal" data-target="#modalPrint">Print</button>
                        }
                        else
                        {
                            <button id="btnPrint" type="button" class="btn btn-primary" disabled data-toggle="modal" data-target="#modalPrint">Print</button>
                        }
                    </div>
                </div>
            </div>*@
    </div>
    <div class="row">
        <div class="col-md-6">
            <div class="form-group">
                @Html.LabelFor(m => m.packingList.TGL, "Tanggal", new { @class = "col-md-4 col-sm-4 col-xs-12 control-label" })
                <div class="col-md-6 col-sm-6 col-xs-12">
                    @Html.HiddenFor(m => m.packingList.TGL)
                    <div class="input-group date">
                        <input type="text" id="TGL" class="form-control" />
                        <span class="input-group-addon">
                            <span class="glyphicon glyphicon-calendar"></span>
                        </span>
                    </div>
                </div>
            </div>
        </div>
        @*<div class="col-md-6">
                <div class="form-group">
                    <div class="col-md-6 col-sm-6 col-xs-1"></div>
                    <div class="col-md-6 col-sm-6 col-xs-11">
                        @if (Model.listDetailPacking.Count > 0)
                        {
                            <button id="btnProses" type="button" class="btn btn-primary" onclick="prosesDetail()">Proses</button>
                        }
                        else
                        {
                            <button id="btnProses" type="button" class="btn btn-primary" disabled onclick="prosesDetail()">Proses</button>
                        }
                    </div>
                </div>
            </div>*@
    </div>
    @if (Model?.packingList?.RecNum != null)
    {
        <div id="btn-simpan-perubahan-row" class="row" style="display: none;">
            <div class="col-lg-4"></div>
            <div class="col-lg-4"></div>
            <div class="col-lg-4">
                <div class="form-group">
                    <div class="col-md-4"></div>
                    <div class="col-md-8">
                        <button id="btn-simpan-perubahan" type="button" class="btn btn-success btn-block">Simpan Perubahan</button>
                    </div>
                </div>
            </div>
        </div>
    }
    <hr />
</div>
@Html.HiddenFor(m => m.detailPackingList.TGL_INPUT, new { Value = DateTime.Now.ToString("dd/MM/yyyy") })

<div class="row" style="margin-top: 15px;">
    <div class="x_content">
        <ul id="detail-packinglist-tabs" class="nav nav-tabs">
            <li class="active"><a data-toggle="tab" id="pesanan_detail_tab_focus" href="#pesanan_detail_tab" aria-expanded="true">Pesanan</a></li>
            @if (Model.listRekapBarang.Count > 0)
            {
                <li><a data-toggle="tab" id="rekap_barang_tab_focus" href="#rekap_barang_tab" aria-expanded="false">Rekap Barang</a></li>
                <li id="li_pesanan_tokped_tab_focus" style="display:none"><a data-toggle="tab" id="pesanan_tokped_tab_focus" href="#packing_pesanan_tokped" aria-expanded="false">Tokopedia</a></li>
                <li id="li_pesanan_lazada_tab_focus" style="display:none"><a data-toggle="tab" id="pesanan_lazada_tab_focus" href="#packing_pesanan_lazada" aria-expanded="false">Lazada</a></li>
                <li id="li_pesanan_shopee_tab_focus" style="display:none"><a data-toggle="tab" id="pesanan_shopee_tab_focus" href="#packing_pesanan_shopee" aria-expanded="false">Shopee</a></li>
                <li id="li_pesanan_blibli_tab_focus" style="display:none"><a data-toggle="tab" id="pesanan_blibli_tab_focus" href="#packing_pesanan_blibli" aria-expanded="false">Blibli</a></li>
            }
            else
            {
                <li><a data-toggle="tab tooltip" id="rekap_barang_tab_focus" href="#rekap_barang_tab" aria-expanded="false" class="disabled-tab" title="Pilih pesanan yang akan masuk packing list terlebih dahulu">Rekap Barang</a></li>
            }
            @*@if (Model.listRekapBarang.Count > 0)
            {
                <li style="margin-left:650px;">
                    <button id="btnPrint" type="button" class="btn btn-primary" data-toggle="modal" data-target="#modalPrint">Print</button>
                </li>
            }
            else
            {
                <li style="margin-left:650px;">
                    <button id="btnPrint" type="button" class="btn btn-primary" disabled data-toggle="modal" data-target="#modalPrint">Print</button>
                </li>
            }*@
        </ul>
        <div class="tab-content">
            <div id="pesanan_detail_tab" class="tab-pane fade active in">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="hscroll table-responsive brgtblpromofrm">
                            <table id="table_tambah_packinglist" class="table table-bordered" role="grid">
                                <thead>
                                    <tr>
                                        <th width="70">No. Pesanan</th>
                                        <th width="80">Tanggal Pesanan</th>
                                        <th width="120">Pembeli</th>
                                        <th width="90">Marketplace</th>
                                        <th width="45">Simpan</th>
                                        <th width="45">Hapus</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var detPackinglist in Model?.listDetailPacking.Where(pb => pb.NO_BUKTI == Model?.packingList?.NO_BUKTI)?.ToList())
                                    {
                                        <tr data-packing-id="brg-@detPackinglist.RecNum">
                                            <td>
                                                @detPackinglist.NO_PESANAN
                                            </td>
                                            <td>
                                                @detPackinglist.TGL_PESANAN.Value.ToString("dd/MM/yyyy")
                                            </td>
                                            <td>
                                                @detPackinglist.PEMBELI
                                            </td>
                                            <td>
                                                @detPackinglist.MARKETPLACE
                                            </td>
                                            <td class="edit-hapus-col">
                                                <button type="button" class="btn btn-primary" disabled="disabled">
                                                    <span class="glyphicon glyphicon-floppy-disk" aria-hidden="true"></span>
                                                </button>
                                            </td>
                                            <td class="edit-hapus-col">
                                                <button class="btn btn-danger" type="button" data-toggle="modal" data-target="#konfHapusPesanan" onclick="passKodeInDb('@detPackinglist.RecNum')">
                                                    <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
                                                </button>
                                            </td>
                                        </tr>
                                    }
                                    <tr data-packing-id="0" id="trNewData">
                                        @Html.HiddenFor(m => m.detailPackingList.NO_BUKTI)
                                        @Html.HiddenFor(m => m.detailPackingList.RecNum)
                                        @Html.HiddenFor(m => m.detailPackingList.TGL_PESANAN)
                                        @Html.HiddenFor(m => m.detailPackingList.PEMBELI)
                                        @Html.HiddenFor(m => m.detailPackingList.MARKETPLACE)
                                        <td style="width: 140px; max-width: 140px;">
                                            @*<div id="BRG" class="selectivity-input" tabindex="0" style="width: 200px; max-width: 200px;"></div>*@
                                            <div id="PESANAN" class="selectivity-input" tabindex="0"></div>
                                            @Html.HiddenFor(m => m.detailPackingList.NO_PESANAN)
                                        </td>
                                        <td class="tgl-pesanan" style="width: 130px; max-width: 130px;"></td>
                                        <td class="pembeli-pesanan" style="width: 130px; max-width: 130px;"></td>
                                        <td class="marketplace-pesanan" style="width: 30px; max-width: 30px;"></td>
                                        <td class="edit-hapus-col">
                                            <button type="button" class="btn btn-primary" disabled="disabled" onclick="simpanpesanan('pesanan-0')">
                                                <span class="glyphicon glyphicon-floppy-disk" aria-hidden="true"></span>
                                            </button>
                                        </td>
                                        <td class="edit-hapus-col">
                                            <button class="btn btn-danger" disabled="disabled" data-toggle="modal" data-target="#konfHapusBarang">
                                                <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div id="rekap_barang_tab" class="tab-pane fade in">
                <div class="row">
                    <div class="col-lg-12">
                        @if (Model.listRekapBarang.Count > 0)
                        {
                            <button id="btnPrint" type="button" class="btn btn-primary" data-toggle="modal" data-target="#modalPrint">Print</button>
                        }
                        else
                        {
                            <button id="btnPrint" type="button" class="btn btn-primary" disabled data-toggle="modal" data-target="#modalPrint">Print</button>
                        }
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-12">
                        <div class="hscroll table-responsive brgtblpromofrm">
                            <table id="table_rekap_packinglist" class="table table-bordered" role="grid">
                                <thead>
                                    <tr>
                                        <th width="70">Kode Barang</th>
                                        <th width="250">Nama Barang</th>
                                        <th width="50">QTY</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var rekapPackinglist in Model?.listRekapBarang?.ToList())
                                    {
                                        <tr>
                                            <td>@rekapPackinglist.BRG</td>
                                            <td>@rekapPackinglist.NAMA_BARANG</td>
                                            <td>@rekapPackinglist.QTY</td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div id="packing_pesanan_tokped" class="tab-pane fade in">
                <div class="col-lg-12" id="packing_pesanan_tokped_content">

                </div>
            </div>
            <div id="packing_pesanan_lazada" class="tab-pane fade in">
                <div class="col-lg-12" id="packing_pesanan_lazada_content">

                </div>
            </div>
            <div id="packing_pesanan_shopee" class="tab-pane fade in">
                <div class="col-lg-12" id="packing_pesanan_shopee_content">

                </div>
            </div>
            <div id="packing_pesanan_blibli" class="tab-pane fade in">
                <div class="col-lg-12" id="packing_pesanan_blibli_content">

                </div>
            </div>
        </div>
    </div>
</div>


