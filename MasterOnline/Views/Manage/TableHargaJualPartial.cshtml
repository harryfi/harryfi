@using System.Globalization
@*@model MasterOnline.ViewModels.HargaJualViewModel*@

@*@{
        var context = new MoDbContext();
    }*@
@using PagedList.Mvc
@model PagedList.IPagedList<mdlHargaJual>
@{
    string currentFilter = ViewBag.CurrentFilter;
    string currentSort = ViewBag.CurrentSort;
    var context = new MoDbContext("");
}
<style>
    #loading_hargaJual_tab {
        display: none;
        width: 100%;
        height: 100%;
        position: fixed;
        z-index: 100;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        background-color: rgba(0,0,0,0);
    }

    #loading_hargaJual_tab_image {
        width: 20px;
        height: 20px;
        margin-top: -90px;
        margin-left: -90px;
        position: absolute;
        top: 50%;
        left: 50%;
        border-width: 30px;
        border-radius: 50%;
    }

    @@media screen and (max-width: 445px) {
        .brgtblhrgajb {
            width: 53%;
        }
    }

    @@media screen and (max-width: 375px) {
        .brgtblhrgajb {
            width: 46%;
        }
    }

    @@media screen and (max-width: 325px) {
        .brgtblhrgajb {
            width: 39%;
        }
    }

    .user-link {
        text-decoration: underline;
    }

</style>
<div id="loading_hargaJual_tab">
    <div id="loading_hargaJual_tab_image">
        <img src="~/Content/Images/spinner.gif" />
    </div>
</div>
<input id="txt_last_page" type="hidden" class="form-control" value="@ViewData["LastPage"]">
<div class="hscroll table-responsive brgtblhrgajb">
    <table class="table table-striped table-bordered table-hover">
        @*<table id="datatable" class="table table-striped table-bordered dataTable" role="grid" aria-describedby="datatable_info">*@
        <thead>
            <tr role="row">
                <th class="sorting text-center" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" style="width: 70px;">Kode Barang</th>
                <th class="sorting text-center" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" style="width: 85px;">Nama Barang</th>
                <th class="sorting text-center" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" style="width: 90px;">Akun MP</th>
                <th class="sorting text-center" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" style="width: 85px;">Harga Jual</th>
                <th class="sorting text-center" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" style="width: 85px;">Harga Beli Terakhir</th>
                <th class="sorting text-center" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" aria-label="Status: activate to sort column ascending" style="width: 60px;">Edit H. Jual</th>
            </tr>
        </thead>
        <tbody>
            @*@foreach (var barangDijualPerMarket in Model.ListHargaJualPerMarket)*@
            @foreach (var barangDijualPerMarket in Model)
            {
                //var idmarket = Model?.ListPelanggan?.FirstOrDefault(b => b.RecNum == barangDijualPerMarket.IDMARKET)?.NAMA;
                //int int_idmarket = (idmarket == "" ? 0 : Convert.ToInt32(idmarket));
                //var namaMarket = context.Marketplaces.FirstOrDefault(m => m.IdMarket == int_idmarket)?.NamaMarket;
                //var namaDepanBarang = Model?.ListBarang?.FirstOrDefault(b => b.BRG == barangDijualPerMarket.BRG)?.NAMA;
                //var namaBelakangBarang = Model?.ListBarang?.FirstOrDefault(b => b.BRG == barangDijualPerMarket.BRG)?.NAMA2;

                var dataDetail = barangDijualPerMarket.BRG + "|" + barangDijualPerMarket.NAMA +  " " + barangDijualPerMarket.NAMA2;
                <tr>
                    <td>@barangDijualPerMarket.BRG</td>
                    <td>
                        @*@namaDepanBarang @namaBelakangBarang*@
                        @barangDijualPerMarket.NAMA @barangDijualPerMarket.NAMA2
                    </td>
                    <td>
                        @*@namaMarket (@barangDijualPerMarket.AKUNMARKET)*@
                        @barangDijualPerMarket.NAMAMARKET (@barangDijualPerMarket.AKUNMARKET)
                    </td>
                    <td style="text-align:right">
                        @String.Format(CultureInfo.CreateSpecificCulture("id-id"), "{0:N}", barangDijualPerMarket.HJUAL)
                    </td>
                    <td style="text-align:right">
                        @*@(Model?.ListHargaTerakhir?.OrderByDescending(b => b.TGL).FirstOrDefault(b => b.BRG == barangDijualPerMarket.BRG)?.HPOKOK)*@
                        @*@String.Format(CultureInfo.CreateSpecificCulture("id-id"), "{0:N}", barangDijualPerMarket.HPOKOK)*@
                        @if (barangDijualPerMarket.HPOKOK != 0)
                        {
                            <a data-tip="Lihat Detail" class="user-link" href="#" data-toggle="modal" data-target="#modalDetailHargaBeliTerakhir" onclick="LihatDetailHargaBeliTerakhir('@dataDetail')">@String.Format(CultureInfo.CreateSpecificCulture("id-id"), "{0:N}", barangDijualPerMarket.HPOKOK)</a>
                        }
                        else
                        {
                            @String.Format(CultureInfo.CreateSpecificCulture("id-id"), "{0:N}", barangDijualPerMarket.HPOKOK)
                        }
                    </td>
                    <td class="edit-hapus-col">
                        @if (barangDijualPerMarket.NAMAMARKET.ToUpper() == "BLIBLI")
                        {
                            <button class="btn btn-primary" data-toggle="modal" data-target="#modalEditHargaJualBlibli"
                                    onclick="passBlibli('@barangDijualPerMarket.RECNUM', '@barangDijualPerMarket.BRG', '@barangDijualPerMarket.NAMA @barangDijualPerMarket.NAMA2', '@barangDijualPerMarket.AKUNMARKET', '@String.Format(CultureInfo.CreateSpecificCulture("id-id"), "{0:N}" , barangDijualPerMarket.STF02_HJUAL)', '@String.Format(CultureInfo.CreateSpecificCulture("id-id"), "{0:N}", barangDijualPerMarket.HJUAL)' )">
                                <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
                            </button>
                        }
                        else if (barangDijualPerMarket.NAMAMARKET.ToUpper() == "82CART")
                        {
                            <button class="btn btn-primary" data-toggle="modal" data-target="#modalEditHargaJual82Cart"
                                    onclick="pass82Cart('@barangDijualPerMarket.RECNUM', '@barangDijualPerMarket.BRG', '@barangDijualPerMarket.NAMA @barangDijualPerMarket.NAMA2', '@barangDijualPerMarket.AKUNMARKET', '@String.Format(CultureInfo.CreateSpecificCulture("id-id"), "{0:N}" , barangDijualPerMarket.STF02_HJUAL)', '@barangDijualPerMarket.STF02_HJUAL' )">
                                <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
                            </button>
                        }
                        else
                        {
                            <button class="btn btn-primary" data-toggle="modal" data-target="#modalEditHargaJual"
                    @*onclick="pass('@barangDijualPerMarket.RecNum', '@barangDijualPerMarket.BRG', '@namaDepanBarang @namaBelakangBarang', '@barangDijualPerMarket.AKUNMARKET', '@String.Format(CultureInfo.CreateSpecificCulture(" id-id"), "{0:N}" , barangDijualPerMarket.HJUAL)')">
                    *@
                                                        onclick="pass('@barangDijualPerMarket.RECNUM', '@barangDijualPerMarket.BRG', '@barangDijualPerMarket.NAMA @barangDijualPerMarket.NAMA2', '@barangDijualPerMarket.AKUNMARKET', '@String.Format(CultureInfo.CreateSpecificCulture("id-id"), "{0:N}", barangDijualPerMarket.HJUAL)')">
                                                    <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
                                                </button>
                                            }
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>

                    @* add by nurul 13/6/2019, paging *@
                        @if(Model.PageCount > 1)
{
                            <div id = "tabelhargaJualpartialpager" class="pager">
                                @Html.PagedListPager(Model, page => Url.Action("RefreshTableHargaJual", new
                           {
                               page,
                               search = ViewData["searchParam"],
                               filter = ViewData["filterParam"]
                           }),
                                new PagedListRenderOptions
                                {
                                    LinkToFirstPageFormat = "<<",
                                    LinkToPreviousPageFormat = "prev",
                                    LinkToNextPageFormat = "next",
                                    LinkToLastPageFormat = ">>",
                                    DisplayEllipsesWhenNotShowingAllPageNumbers = false
                                })
                                Page @(Model.PageCount<Model.PageNumber? 0 : Model.PageNumber) of @Model.PageCount

                            </div>
                        }
</div>
                        <script type = "text/javascript" >
                            $(function () {
                                $('#tabelhargaJualpartialpager').on('click', 'a', function () {
                        if (this.href != "")
                        {
                                        $.ajax({
                                url: this.href,
                                            type: 'GET',
                                            cache: false,
                                            beforeSend: function() {
                                                $('#loading_hargaJual_tab').show();
                                },
                                            success: function(response) {
                                                $('#table-hargaJual-partial').html(response);
                                                $('#loading_hargaJual_tab').hide();
                                }
                            });
                        }
                        return false;

});
                            });
                        </script>
                    @* end add by nurul 13/6/2019, paging *@
