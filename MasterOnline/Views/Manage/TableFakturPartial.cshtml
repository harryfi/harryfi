@using System.Globalization
@model MasterOnline.ViewModels.FakturViewModel
<table id="datatable" class="table table-striped table-bordered dataTable" role="grid" aria-describedby="datatable_info">
    <thead>
        <tr role="row">
            <th class="sorting_asc" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" aria-sort="ascending" aria-label="Name: activate to sort column descending" style="width: 90px;">No. Faktur</th>
            <th class="sorting" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" aria-label="Position: activate to sort column ascending" style="width: 100px;">Tanggal Faktur</th>
            <th class="sorting" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" aria-label="Office: activate to sort column ascending" style="width: 90px;">Marketplace</th>
            @*add by nurul 7/11/2018*@
            <th class="sorting" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" aria-label="Office: activate to sort column ascending" style="width: 90px;">No. Referensi</th>
            @*end add by nurul*@
            <th class="sorting" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" aria-label="Age: activate to sort column ascending" style="width: 90px;">Pembeli</th>
            <th class="sorting" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" aria-label="Start date: activate to sort column ascending" style="width: 90px;">Total</th>
            <th class="sorting" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" aria-label="Start date: activate to sort column ascending" style="width: 60px;">Posting</th>
            <th class="sorting text-center" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" aria-label="Salary: activate to sort column ascending" style="width: 60px;">Edit / Lihat</th>
            @*add by nurul 3/12/2018*@
            <th class="sorting text-center" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" aria-label="Salary: activate to sort column ascending" style="width: 90px; ">Cetak Faktur</th>
            @*end add by nurul*@ 
            <th class="sorting text-center" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" aria-label="Status: activate to sort column ascending" style="width: 50px; max-width: 50px;">Hapus</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var faktur in Model.ListFaktur)
        {
            var buyer = Model.ListPembeli.FirstOrDefault(m => m.BUYER_CODE == faktur.PEMESAN);
            var pelanggan = Model.ListPelanggan.FirstOrDefault(m => m.CUST == faktur.CUST);

            var buyerNama = "";
            var buyerPerso = "";
            if (buyer != null)
            {
                buyerNama = buyer.NAMA;
                buyerPerso = buyer.PERSO;
            }

            var perso = "";
            if (pelanggan != null)
            {
                perso = pelanggan.PERSO;
            }

            var idMarket = 0;
            if (pelanggan != null)
            {
                idMarket = Convert.ToInt32(pelanggan.NAMA);
            }

            var market = Model.ListMarketplace.FirstOrDefault(m => m.IdMarket == idMarket);
            var NamaMarket = "";
            if (market != null)
            {
                NamaMarket = market.NamaMarket;
            }
            var nFaktur = Model.ListNFaktur.FirstOrDefault(n => n.NFAKTUR == faktur.NO_BUKTI);
            var pesananSesuaiFaktur = Model.ListPesanan.FirstOrDefault(p => p.NO_BUKTI == faktur.NO_SO);
        <tr>
            <td>@faktur.NO_BUKTI</td>
            <td>@(faktur.TGL.ToString("dd/MM/yyyy"))</td>
            <td>@NamaMarket</td>
            @*add by nurul 7/11/2018*@
            <td>@faktur.NO_REF</td>
            @*end add by nurul*@
            <td>
                @*remark by nurul 24/9/2018 @(buyer.NAMA + " (" + buyer.PERSO + ")")*@
                @*@((buyer == null ? "" : buyer.NAMA) + " (" + pelanggan.PERSO + ")")*@
                @(buyerNama + " (" + perso + ")")
            </td>
            <td>@String.Format(CultureInfo.CreateSpecificCulture("id-id"), "{0:N}", faktur.NETTO)</td>
            @if (Convert.ToString(faktur.ST_POSTING) == "Y")
            {
                <td>
                    Sudah
                </td>
            }
            else
            {
                <td>
                    Belum
                </td>
            }
            <td class="edit-hapus-col">
                @* remark by nurul 29/8/2018 -- @if (pesananSesuaiFaktur?.STATUS_TRANSAKSI == "04" || Convert.ToString(faktur.ST_POSTING) == "Y" || nFaktur != null)*@
                @if (faktur.NO_SO != "" || Convert.ToString(faktur.ST_POSTING) == "Y" || nFaktur != null)
                {
                    <!-- Kalau faktur hasil generate dari pesanan tidak boleh diubah -->
                    <button class="btn btn-primary" onclick="lihatFaktur(@faktur.RecNum)">
                        <span class="glyphicon glyphicon-eye-open" aria-hidden="true"></span>
                    </button>
                }
                else
                {
                    <button class="btn btn-primary" onclick="editFaktur1(@faktur.RecNum.)">
                        <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
                    </button>
                }
            </td>
            <td class="edit-hapus-col">
                @*@if (generatedFaktur == null)
                {
                    <button class="btn btn-primary buat_faktur" onclick="buatFaktur(@pesanan.RecNum)">
                        <span class="glyphicon glyphicon-file" aria-hidden="true"></span>
                    </button>
                }
                else
                {*@
                    <button class="btn btn-primary lihat_faktur" onclick="cetakFaktur('@(faktur.NO_BUKTI)')">
                        <span class="glyphicon glyphicon-eye-open" aria-hidden="true"></span>
                    </button>
                @*}*@
            </td>
            <td class="edit-hapus-col">
                @if (pesananSesuaiFaktur?.STATUS_TRANSAKSI == "04" || Convert.ToString(faktur.ST_POSTING) == "Y" || nFaktur != null)
                {
                    <button class="btn btn-danger" onclick="undeleteableFaktur()">
                        <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
                    </button>
                }
                else
                {
                    <button class="btn btn-danger" data-toggle="modal" data-target="#konfHapusFaktur" onclick="pass(@faktur.RecNum)">
                        <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
                    </button>
                }
            </td>
        </tr>
        }
    </tbody>
</table>

