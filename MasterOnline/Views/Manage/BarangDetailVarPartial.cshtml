@using System.Globalization
@using MasterOnline.ViewModels
@model MasterOnline.ViewModels.BarangStrukturVarViewModel
@{
    var dataSession = Session["SessionInfo"] as AccountUserViewModel;
    var username = "";
    var context = new MoDbContext();
    if (dataSession?.User != null)
    {
        var accId = context.User.Single(u => u.Username == dataSession.User.Username).AccountId;
        username = context.Account.Single(a => a.AccountId == accId).Username;
    }
    else
    {
        username = dataSession?.Account.Username;
    }
}
@Html.AntiForgeryToken()
<script type="text/javascript">
    $(document).ready(function () {
        
    });
</script>
<div class="form-horizontal">
    <div id="variant-section">
        <table style="width:100%">
            <tr>
                <td style="width:90%">
                    <ul id="variant-tabs" class="nav nav-tabs">
                        <li><a data-toggle="tab" href="#masteronline_detail_tab_variant">Master Online</a></li>
                        @{
                            var listMarket = Model.ListMarket;
                            var adaElevenia_variant = 0;
                            var adaBlibli_variant = 0;
                            var adaBukalapak_variant = 0;
                            var adaLazada_variant = 0;
                            var adaShopee_variant = 0;
                        }
                        @for (var i = 0; i < listMarket.ToList().Count; i++)
            {
                var idMarket = Convert.ToInt32(listMarket[i].NAMA);
                if (context.Marketplaces.Single(m => m.IdMarket == idMarket).NamaMarket.ToUpper().Equals("ELEVENIA"))
                {
                    adaElevenia_variant = 1;
                }
                else if (context.Marketplaces.Single(m => m.IdMarket == idMarket).NamaMarket.ToUpper().Equals("BLIBLI"))
                {
                    adaBlibli_variant = 1;
                }
                else if (context.Marketplaces.Single(m => m.IdMarket == idMarket).NamaMarket.ToUpper().Equals("BUKALAPAK"))
                {
                    adaBukalapak_variant = 1;
                }
                else if (context.Marketplaces.Single(m => m.IdMarket == idMarket).NamaMarket.ToUpper().Equals("LAZADA"))
                {
                    adaLazada_variant = 1;
                }
                else if (context.Marketplaces.Single(m => m.IdMarket == idMarket).NamaMarket.ToUpper().Equals("SHOPEE"))
                {
                    adaShopee_variant = 1;
                }
            }
                        @if (adaElevenia_variant == 1)
            {
                        <li><a data-toggle="tab" href="#elevenia_detail_tab_variant">Elevenia</a></li>
                        }
                        @if (adaBlibli_variant == 1)
            {
                        <li><a data-toggle="tab" href="#blibli_detail_tab_variant">Blibli</a></li>
                        }
                        @if (adaLazada_variant == 1)
            {
                        <li><a data-toggle="tab" href="#lazada_detail_tab_variant">Lazada</a></li>
                        }
                        @if (adaShopee_variant == 1)
            {
                        <li><a data-toggle="tab" href="#shopee_detail_tab_variant">Shopee</a></li>
                        }
                    </ul>
                </td>
                <td style="width:10%">
                    <input type="button" class="btn btn-primary pull-right" id="proses_var_btn" value="Proses" onclick="prosesBarangVarPartial()" />
                </td>
            </tr>
        </table>

        <div class="tab-content">
            <div id="masteronline_detail_tab_variant" class="tab-pane fade in active">
                <div class="row" style="padding-top:10px">
                    <div class="col-md-12 col-sm-12 col-xs-12">
                        @{
                            var shopeeCategoryCodeFound = -1;
                        }
                        @for (var i = 0; i < listMarket.ToList().Count; i++)
                        {
                            if (shopeeCategoryCodeFound == -1)
                            {
                                var idMarket = Convert.ToInt32(listMarket[i].NAMA);
                                var recnumArf01 = Convert.ToInt32(listMarket[i].RecNum);
                                if (context.Marketplaces.SingleOrDefault(m => m.IdMarket == idMarket).NamaMarket.ToUpper().Equals("SHOPEE"))
                                {
                                    if (!string.IsNullOrEmpty(listMarket[i].Sort1_Cust))
                                    {
                                        shopeeCategoryCodeFound = i;
                                        @Html.TextBox("txtShopeeCategoryCodeFound", @shopeeCategoryCodeFound, new { @class = "form-control", disabled = "disabled", @style = "display:none;" })
                                    }
                                }
                            }
                        }
                        <div class="form-group" style="display:none">
                            @Html.Label("lblKodeKategori", "Kode Kategori", new { @class = "control-label col-md-2 col-sm-2 col-xs-12" })
                            <div class="col-md-4 col-sm-4 col-xs-12">
                                @Html.TextBox("txtKodeKategori", Model.Kategori.KODE, new { @class = "form-control", disabled = "disabled" })
                            </div>
                        </div>
                        <div class="form-group">
                            @Html.Label("lblNamaKategori", "Kategori", new { @class = "control-label col-md-2 col-sm-2 col-xs-12" })
                            <div class="col-md-4 col-sm-4 col-xs-12">
                                @Html.TextBox("txtNamaKategori", Model.Kategori.KET, new { @class = "form-control", disabled = "disabled" })
                            </div>
                        </div>
                        @if (!string.IsNullOrWhiteSpace(Model.Variant_Level_1.VALUE_JUDUL_VAR))
                        {
                            <div class="form-group">
                                <label class="control-label col-md-2 col-sm-2 col-xs-12">
                                    @($"Variasi Level 1")
                                </label>
                                <div class="col-md-4 col-sm-4 col-xs-12">
                                    @Html.TextBoxFor(m => m.Variant_Level_1.VALUE_JUDUL_VAR, new { @class = "form-control", disabled = "disabled", Value = Model.Variant_Level_1.VALUE_JUDUL_VAR, placeholder = "" })
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-md-2 col-sm-2 col-xs-12">
                                    @($"Opsi Tersedia")
                                </label>
                                <div class="col-md-4"><select id="select_opt_level_1" placeholder="Harap pilih"></select></div>
                            </div>
                        }
                        @if (!string.IsNullOrWhiteSpace(Model.Variant_Level_2.VALUE_JUDUL_VAR))
                        {
                            <div class="form-group">
                                <label class="control-label col-md-2 col-sm-2 col-xs-12">
                                    @($"Variasi Level 2")
                                </label>
                                <div class="col-md-4 col-sm-4 col-xs-12">
                                    @Html.TextBoxFor(m => m.Variant_Level_2.VALUE_JUDUL_VAR, new { @class = "form-control", disabled = "disabled", Value = Model.Variant_Level_2.VALUE_JUDUL_VAR, placeholder = "" })
                                </div>
                                <div class="col-md-5 col-sm-5 col-xs-12">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-md-2 col-sm-2 col-xs-12">
                                    @($"Opsi Tersedia")
                                </label>
                                <div class="col-md-4"><select id="select_opt_level_2" placeholder="Harap pilih"></select></div>
                            </div>
                        }
                        @if (!string.IsNullOrWhiteSpace(Model.Variant_Level_3.VALUE_JUDUL_VAR))
                        {
                            <div class="form-group">
                                <label class="control-label col-md-2 col-sm-2 col-xs-12">
                                    @($"Variasi Level 3")
                                </label>
                                <div class="col-md-4 col-sm-4 col-xs-12">
                                    @Html.TextBoxFor(m => m.Variant_Level_3.VALUE_JUDUL_VAR, new { @class = "form-control", disabled = "disabled", Value = Model.Variant_Level_3.VALUE_JUDUL_VAR, placeholder = "" })
                                </div>
                                <div class="col-md-5 col-sm-5 col-xs-12">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-md-2 col-sm-2 col-xs-12">
                                    @($"Opsi Tersedia")
                                </label>
                                <div class="col-md-4"><select id="select_opt_level_3" placeholder="Harap pilih"></select></div>
                            </div>
                        }
                        <div class="form-group">
                            <div class="col-md-4">
                                <input type="button" class="btn btn-primary pull-right" id="proses_var_btn" value="Simpan" onclick="prosesBarangVarPartial()" />
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="elevenia_detail_tab_variant" class="tab-pane fade in">
            </div>
            <div id="blibli_detail_tab_variant" class="tab-pane fade in">
            </div>
            <div id="lazada_detail_tab_variant" class="tab-pane fade in">
            </div>
            <div id="shopee_detail_tab_variant" class="tab-pane fade in">
                <div class="row" style="padding-top:10px">
                    <div class="col-md-12 col-sm-12 col-xs-12">
                        <div class="form-group" style="display:none">
                            @Html.Label("lblKodeKategoriShopee", "Kode Kategori", new { @class = "control-label col-md-2 col-sm-2 col-xs-12" })
                            <div class="col-md-4 col-sm-4 col-xs-12">
                                @Html.TextBox("txtKodeKategoriShopee", "", new { @class = "form-control", disabled = "disabled" })
                            </div>
                        </div>
                        <div class="form-group">
                            @Html.Label("lblNamaKategoriShopee", "Kategori MO", new { @class = "control-label col-md-2 col-sm-2 col-xs-12" })
                            <div class="col-md-4 col-sm-4 col-xs-12">
                                @Html.TextBox("txtNamaKategoriMOShopee", Model.Kategori.KET, new { @class = "form-control", disabled = "disabled" })
                            </div>
                            @Html.Label("lblNamaKategoriShopee", "Kategori Shopee", new { @class = "control-label col-md-2 col-sm-2 col-xs-12" })
                            <div class="col-md-4 col-sm-4 col-xs-12">
                                @Html.TextBox("txtNamaKategoriShopee", "", new { @class = "form-control", disabled = "disabled" })
                            </div>
                        </div>
                        @{
                            var code_kategori1 = Model.Kategori.KODE;
                            var VariantOptMasterLv1 = Model.VariantOptMaster.Where(p => p.LEVEL_VAR == 1 && p.CATEGORY_MO == code_kategori1).ToList();
                            var VariantPerMpShopeeLv1 = Model.VariantPerMP.Where(p => p.LEVEL_VAR == 1 && p.CATEGORY_MO == code_kategori1 && p.MARKET == "SHOPEE").OrderBy(p => p.RECNUM).ToList();
                            if (VariantPerMpShopeeLv1.Count() > 0)
                            {
                                var textJudulVar1 = "";
                                var judulVar1 = VariantPerMpShopeeLv1.FirstOrDefault();
                                if (judulVar1 != null)
                                {
                                    textJudulVar1 = judulVar1.MP_JUDUL_VAR;
                                }
                                <div class="form-group">
                                    <div class="col-md-6 col-sm-6 col-xs-12">
                                        <table style="width:100%">
                                            <tr>
                                                <td style="vertical-align:top !important;">
                                                    <table class="table table-bordered" style="width:100%;border-right:none" role="grid">
                                                        <thead>
                                                            <tr>
                                                                <th width="100%" style="border-right:none">Judul Variasi Master Online</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <tr>
                                                                <td>
                                                                    @Html.TextBox("txtJudulMOShopeeLv1", Model.Variant_Level_1.VALUE_JUDUL_VAR, new
                                                               {
                                                                   @class = "form-control",
                                                                   disabled = "disabled",
                                                                   @style = "border:none;background-color:#fff;box-shadow:none;"
                                                               })
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </td>
                                                <td style="vertical-align:top !important">
                                                    <table class="table table-bordered" style="width:100%" role="grid">
                                                        <thead>
                                                            <tr>
                                                                <th width="100%">Nama Opsi Master Online</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            @for (int i = 0; i < VariantPerMpShopeeLv1.Count(); i++)
                                                            {
                                                                var textKetVar1 = "";
                                                                var KetVar1 = VariantOptMasterLv1.Where(p => p.KODE_VAR == VariantPerMpShopeeLv1[i].KODE_VAR).FirstOrDefault();
                                                                if (KetVar1 != null)
                                                                {
                                                                    textKetVar1 = KetVar1.KET_VAR;
                                                                }
                                                                <tr>
                                                                    <td>
                                                                        @Html.TextBox("txtOpsiMOShopeeLv1", textKetVar1, new
                                                                   {
                                                                       @class = "form-control",
                                                                       disabled = "disabled",
                                                                       @style = "border:none;background-color:#fff;box-shadow:none;"
                                                                   })
                                                                    </td>
                                                                </tr>
                                                            }
                                                        </tbody>
                                                    </table>
                                                </td>
                                            </tr>
                                        </table>
                                    </div>
                                    <div class="col-md-6 col-sm-6 col-xs-12">
                                        <table style="width:100%">
                                            <tr>
                                                <td style="vertical-align:top !important;">
                                                    <table class="table table-bordered" style="width:100%;border-right:none" role="grid">
                                                        <thead>
                                                            <tr>
                                                                <th width="100%" style="border-right:none">Judul Variasi Shopee</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <tr>
                                                                <td>
                                                                    @Html.TextBox("txtJudulVariantShopeeLv1", textJudulVar1, new
                                                               {
                                                                   @class = "form-control",
                                                                   placeholder = "Nama Variasi untuk Shopee"
                                                               })
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </td>
                                                <td style="vertical-align:top !important">
                                                    <table class="table table-bordered" style="width:100%" role="grid">
                                                        <thead>
                                                            <tr>
                                                                <th width="100%">Nama Opsi Shopee</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            @for (int i = 0; i < VariantPerMpShopeeLv1.Count(); i++)
                                                            {
                                                                <tr>
                                                                    <td>
                                                                        @Html.TextBox("txtVariantShopeeLv1_" + VariantPerMpShopeeLv1[i].RECNUM, VariantPerMpShopeeLv1[i].MP_VALUE_VAR, new
                                                                   {
                                                                       @class = "form-control txtVariantShopeeLv1_",
                                                                       placeholder = "Nama Opsi untuk Shopee"
                                                                   })
                                                                    </td>
                                                                </tr>
                                                            }
                                                        </tbody>
                                                    </table>
                                                </td>
                                            </tr>
                                        </table>
                                    </div>
                                </div>
                            }

                            var code_kategori2 = Model.Kategori.KODE;
                            var VariantOptMasterLv2 = Model.VariantOptMaster.Where(p => p.LEVEL_VAR == 2 && p.CATEGORY_MO == code_kategori2).ToList();
                            var VariantPerMpShopeeLv2 = Model.VariantPerMP.Where(p => p.LEVEL_VAR == 2 && p.CATEGORY_MO == code_kategori2 && p.MARKET == "SHOPEE").OrderBy(p => p.RECNUM).ToList();
                            if (VariantPerMpShopeeLv2.Count() > 0)
                            {
                                var textJudulVar2 = "";
                                var judulVar2 = VariantPerMpShopeeLv1.FirstOrDefault();
                                if (judulVar2 != null)
                                {
                                    textJudulVar2 = judulVar2.MP_JUDUL_VAR;
                                }
                                <div class="form-group">
                                    <div class="col-md-6 col-sm-6 col-xs-12">
                                        <table style="width:100%">
                                            <tr>
                                                <td style="vertical-align:top !important;">
                                                    <table class="table table-bordered" style="width:100%;border-right:none" role="grid">
                                                        <thead>
                                                            <tr>
                                                                <th width="100%" style="border-right:none">Judul Variasi Master Online</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <tr>
                                                                <td>
                                                                    @Html.TextBox("txtJudulMOShopeeLv2", Model.Variant_Level_2.VALUE_JUDUL_VAR, new
                                                               {
                                                                   @class = "form-control",
                                                                   disabled = "disabled",
                                                                   @style = "border:none;background-color:#fff;box-shadow:none;"
                                                               })
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </td>
                                                <td style="vertical-align:top !important">
                                                    <table class="table table-bordered" style="width:100%" role="grid">
                                                        <thead>
                                                            <tr>
                                                                <th width="100%">Nama Opsi Master Online</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            @for (int i = 0; i < VariantPerMpShopeeLv2.Count(); i++)
                                                            {
                                                                var textKetVar2 = "";
                                                                var KetVar2 = VariantOptMasterLv2.Where(p => p.KODE_VAR == VariantPerMpShopeeLv2[i].KODE_VAR).FirstOrDefault();
                                                                if (KetVar2 != null)
                                                                {
                                                                    textKetVar2 = KetVar2.KET_VAR;
                                                                }
                                                                <tr>
                                                                    <td>
                                                                        @Html.TextBox("txtOpsiMOShopeeLv2", textKetVar2, new
                                                                   {
                                                                       @class = "form-control",
                                                                       disabled = "disabled",
                                                                       @style = "border:none;background-color:#fff;box-shadow:none;"
                                                                   })
                                                                    </td>
                                                                </tr>
                                                            }
                                                        </tbody>
                                                    </table>
                                                </td>
                                            </tr>
                                        </table>
                                    </div>
                                    <div class="col-md-6 col-sm-6 col-xs-12">
                                        <table style="width:100%">
                                            <tr>
                                                <td style="vertical-align:top !important;">
                                                    <table class="table table-bordered" style="width:100%;border-right:none" role="grid">
                                                        <thead>
                                                            <tr>
                                                                <th width="100%" style="border-right:none">Judul Variasi Shopee</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <tr>
                                                                <td>
                                                                    @Html.TextBox("txtJudulVariantShopeeLv2", textJudulVar2, new
                                                               {
                                                                   @class = "form-control",
                                                                   placeholder = "Nama Variasi untuk Shopee"
                                                               })
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </td>
                                                <td style="vertical-align:top !important">
                                                    <table class="table table-bordered" style="width:100%" role="grid">
                                                        <thead>
                                                            <tr>
                                                                <th width="100%">Nama Opsi Shopee</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            @for (int i = 0; i < VariantPerMpShopeeLv2.Count(); i++)
                                                            {
                                                                <tr>
                                                                    <td>
                                                                        @Html.TextBox("txtVariantShopeeLv2_" + VariantPerMpShopeeLv2[i].RECNUM, VariantPerMpShopeeLv2[i].MP_VALUE_VAR, new
                                                                   {
                                                                       @class = "form-control txtVariantShopeeLv2_",
                                                                       placeholder = "Nama Opsi untuk Shopee"
                                                                   })
                                                                    </td>
                                                                </tr>
                                                            }
                                                        </tbody>
                                                    </table>
                                                </td>
                                            </tr>
                                        </table>
                                    </div>
                                </div>
                            }

                            var code_kategori3 = Model.Kategori.KODE;
                            var VariantOptMasterLv3 = Model.VariantOptMaster.Where(p => p.LEVEL_VAR == 3 && p.CATEGORY_MO == code_kategori3).ToList();
                            var VariantPerMpShopeeLv3 = Model.VariantPerMP.Where(p => p.LEVEL_VAR == 3 && p.CATEGORY_MO == code_kategori3 && p.MARKET == "SHOPEE").OrderBy(p => p.RECNUM).ToList();
                            if (VariantPerMpShopeeLv3.Count() > 0)
                            {
                                var textJudulVar3 = "";
                                var judulVar3 = VariantPerMpShopeeLv3.FirstOrDefault();
                                if (judulVar3 != null)
                                {
                                    textJudulVar3 = judulVar3.MP_JUDUL_VAR;
                                }
                                <div class="form-group">
                                    <div class="col-md-6 col-sm-6 col-xs-12">
                                        <table style="width:100%">
                                            <tr>
                                                <td style="vertical-align:top !important;">
                                                    <table class="table table-bordered" style="width:100%;border-right:none" role="grid">
                                                        <thead>
                                                            <tr>
                                                                <th width="100%" style="border-right:none">Judul Variasi Master Online</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <tr>

                                                                <td>
                                                                    @Html.TextBox("txtJudulMOShopeeLv3", Model.Variant_Level_3.VALUE_JUDUL_VAR, new
                                                               {
                                                                   @class = "form-control",
                                                                   disabled = "disabled",
                                                                   @style = "border:none;background-color:#fff;box-shadow:none;"
                                                               })
                                                                </td>

                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </td>
                                                <td style="vertical-align:top !important">
                                                    <table class="table table-bordered" style="width:100%" role="grid">
                                                        <thead>
                                                            <tr>
                                                                <th width="100%">Nama Opsi Master Online</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            @for (int i = 0; i < VariantPerMpShopeeLv3.Count(); i++)
                                                            {
                                                                var textKetVar3 = "";
                                                                var KetVar3 = VariantOptMasterLv3.Where(p => p.KODE_VAR == VariantPerMpShopeeLv3[i].KODE_VAR).FirstOrDefault();
                                                                if (KetVar3 != null)
                                                                {
                                                                    textKetVar3 = KetVar3.KET_VAR;
                                                                }
                                                                <tr>
                                                                    <td>
                                                                        @Html.TextBox("txtOpsiMOShopeeLv3", textKetVar3, new
                                                                   {
                                                                       @class = "form-control",
                                                                       disabled = "disabled",
                                                                       @style = "border:none;background-color:#fff;box-shadow:none;"
                                                                   })
                                                                    </td>
                                                                </tr>
                                                            }
                                                        </tbody>
                                                    </table>
                                                </td>
                                            </tr>
                                        </table>
                                    </div>
                                    <div class="col-md-6 col-sm-6 col-xs-12">
                                        <table style="width:100%">
                                            <tr>
                                                <td style="vertical-align:top !important;">
                                                    <table class="table table-bordered" style="width:100%;border-right:none" role="grid">
                                                        <thead>
                                                            <tr>
                                                                <th width="100%" style="border-right:none">Judul Variasi Shopee</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <tr>
                                                                <td>
                                                                    @Html.TextBox("txtJudulVariantShopeeLv3", textJudulVar3, new
                                                               {
                                                                   @class = "form-control",
                                                                   placeholder = "Nama Variasi untuk Shopee"
                                                               })
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </td>
                                                <td style="vertical-align:top !important">
                                                    <table class="table table-bordered" style="width:100%" role="grid">
                                                        <thead>
                                                            <tr>
                                                                <th width="100%">Nama Opsi Shopee</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            @for (int i = 0; i < VariantPerMpShopeeLv3.Count(); i++)
                                                            {
                                                                <tr>
                                                                    <td>
                                                                        @Html.TextBox("txtVariantShopeeLv3_" + VariantPerMpShopeeLv3[i].RECNUM, VariantPerMpShopeeLv3[i].MP_VALUE_VAR, new
                                                                   {
                                                                       @class = "form-control txtVariantShopeeLv3_",
                                                                       placeholder = "Nama Opsi untuk Shopee"
                                                                   })
                                                                    </td>
                                                                </tr>
                                                            }
                                                        </tbody>
                                                    </table>
                                                </td>
                                            </tr>
                                        </table>
                                    </div>
                                </div>
                            }
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
