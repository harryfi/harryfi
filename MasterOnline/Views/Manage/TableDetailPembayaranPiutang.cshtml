@using System.Globalization
@model MasterOnline.ViewModels.BayarPiutangViewModel
<script type="text/javascript">
@{
    var listFaktur = Model?.listFakturBelumLunas.ToList();
    
}
var listFaktur = @Html.Raw(Json.Encode(listFaktur));
    
</script>

<div class="row" style="margin-top: 15px;">
    <div class="col-lg-12">
        <div class="hscroll table-responsive fakturtblpiutangfrm">
            @*<table id="table_tambah_piutang" class="table table-bordered" role="grid">*@
            @*<h5 class="pull-right" style="margin-top: 0;">Mata uang Rupiah (IDR)</h5>*@
            <table id="table_tambah_piutang" class="table table-striped table-bordered dataTable" role="grid" aria-describedby="datatable_info">
                <thead>
                    <tr role="row">
                        <th class="sorting" tabindex="0" aria-controls="table_tambah_piutang" rowspan="1" colspan="1" width="100px">No. Faktur</th>
                        <th class="sorting" tabindex="0" aria-controls="table_tambah_piutang" rowspan="1" colspan="1" width="100px">No. Ref</th>
                        <th class="sorting" tabindex="0" aria-controls="table_tambah_piutang" rowspan="1" colspan="1" width="100px">Tgl. Ref</th>
                        <th class="sorting" tabindex="0" aria-controls="table_tambah_piutang" rowspan="1" colspan="1" width="100px">Nilai Faktur</th>
                        <th class="sorting" tabindex="0" aria-controls="table_tambah_piutang" rowspan="1" colspan="1" width="100px">Nilai Ref</th>
                        <th class="sorting" tabindex="0" aria-controls="table_tambah_piutang" rowspan="1" colspan="1" width="100px">Nilai Potongan</th>
                        <th class="sorting" tabindex="0" aria-controls="table_tambah_piutang" rowspan="1" colspan="1" width="100px">Kurang Bayar</th>
                        <th class="sorting" tabindex="0" aria-controls="table_tambah_piutang" rowspan="1" colspan="1" width="100px">Lebih Bayar</th>
                        <th class="sorting" tabindex="0" aria-controls="table_tambah_piutang" rowspan="1" colspan="1" width="60px">% selisih</th>
                        <th class="sorting" tabindex="0" aria-controls="table_tambah_piutang" rowspan="1" colspan="1" width="45px">Simpan</th>
                        <th class="sorting" tabindex="0" aria-controls="table_tambah_piutang" rowspan="1" colspan="1" width="45px">Hapus</th>

                        @*<th width="100px">No. Faktur</th>
                    <th width="100px">No. Ref</th>
                    <th width="100px">Tgl. Ref</th>
                    @*<th width="200">Sisa</th>
                    <th width="100px">Nilai Faktur</th>
                    <th width="100px">Nilai Ref</th>
                    <th width="100px">Nilai Potongan</th>
                    @*<th width="100px">Selisih</th>
                    <th width="100px">Kurang Bayar</th>
                    <th width="100px">Lebih Bayar</th>
                    <th width="60px">% selisih</th>
                    <th width="45px">Simpan</th>
                    <th width="45px">Hapus</th>*@
                    </tr>
                </thead>
                <tbody>
                    @{
                        var iPd = 0;
                    }
                    @foreach (var detailPiutang in Model.ListPiutangDetail)
                    {
                        //string lebihbayar = (detailPiutang?.LEBIH_BAYAR == null ? 0 : detailPiutang?.LEBIH_BAYAR);
                        <tr data-piutang-id="piu-@detailPiutang.NO">
                            <td>
                                @detailPiutang.NFAKTUR
                            </td>
                            <td>@detailPiutang.NOREF</td>
                            <td>@detailPiutang.TGL_REF.GetValueOrDefault().ToString("dd/MM/yyyy")</td>
                            <td class="sisa-piutang" style="text-align:right">
                                @*@String.Format(CultureInfo.CreateSpecificCulture("id-id"), "{0:N}", detailPiutang.SISA)*@
                                <span class="sisa-initial">@String.Format(CultureInfo.CreateSpecificCulture("id-id"), "{0:N}", detailPiutang.SISA)</span>
                            </td>
                            <td class="bayar-piutang" style="text-align:right">
                                <span class="nilairef-initial">@String.Format(CultureInfo.CreateSpecificCulture("id-id"), "{0:N}", detailPiutang.BAYAR)</span>
                            </td>
                            <td class="potongan-piutang" data-selisih="@String.Format(CultureInfo.CreateSpecificCulture("id-id"), "{0:N}", (detailPiutang.SISA - detailPiutang.BAYAR - detailPiutang.POT))" data-rec="@detailPiutang.NO" data-faktur="@detailPiutang.NFAKTUR" style="text-align:right">
                                @*@String.Format(CultureInfo.CreateSpecificCulture("id-id"), "{0:N}", detailPiutang.POT)*@
                                <input min="0" class="pot-input-box num-only" style="display: none;" />
                                <span class="pot-initial">@String.Format(CultureInfo.CreateSpecificCulture("id-id"), "{0:N}", detailPiutang.POT)</span>
                            </td>
                            <td class="selisih-piutang" data-selisih-gagal="@String.Format(CultureInfo.CreateSpecificCulture("id-id"), "{0:N}", (detailPiutang.SISA - detailPiutang.BAYAR - detailPiutang.POT))" style="text-align:right">
                                @*@String.Format(CultureInfo.CreateSpecificCulture("id-id"), "{0:N}", detailPiutang.BAYAR)*@
                                <input min="0" class="selisih-input-box num-only" style="display: none;" />
                                <span class="selisih-initial">@String.Format(CultureInfo.CreateSpecificCulture("id-id"), "{0:N}", (detailPiutang.SISA - detailPiutang.BAYAR - detailPiutang.POT))</span>
                            </td>
                            <td class="lebihbayar-piutang" style="text-align:right">
                                <span class="lebihbayar-initial">@String.Format(CultureInfo.CreateSpecificCulture("id-id"), "{0:N}", detailPiutang.LEBIH_BAYAR)</span>
                            </td>
                            <td class="persen-selisih" data-persen-gagal="@String.Format(CultureInfo.CreateSpecificCulture("id-id"), "{0:N}", ((detailPiutang.SISA - detailPiutang.BAYAR - detailPiutang.POT) / detailPiutang.SISA * 100))" data-persen-lebihbayar="@String.Format(CultureInfo.CreateSpecificCulture("id-id"), "{0:N}", ((detailPiutang?.LEBIH_BAYAR) / detailPiutang.SISA * 100))">
                                @*<input min="0" class="persen-input-box num-only" style="display: none;" />*@
                                @{
                                    double? tempPersen1 = 0;
                                    if (detailPiutang?.LEBIH_BAYAR > 0)
                                    {
                                        tempPersen1 = (detailPiutang?.LEBIH_BAYAR / detailPiutang?.SISA * 100);
                                    }
                                    else if ((detailPiutang?.SISA - detailPiutang?.BAYAR - detailPiutang?.POT) > 0 && (detailPiutang?.SISA - detailPiutang?.BAYAR - detailPiutang?.POT) != null)
                                    {
                                        tempPersen1 = ((detailPiutang?.SISA - detailPiutang?.BAYAR - detailPiutang?.POT) / detailPiutang?.SISA * 100);
                                    }
                                }
                                <span class="persen-initial">@String.Format(CultureInfo.CreateSpecificCulture("id-id"), "{0:N}", tempPersen1) %</span>
                            </td>
                            @*<td class="edit-hapus-col">
                            <button type="button" class="btn btn-primary" onclick="editDetail('piu-@detailPiutang.NO')">
                                <span class="icon-btn-edit glyphicon glyphicon-pencil" aria-hidden="true"></span>

                            </button>
                        </td>*@
                            <td class="edit-hapus-col">
                                <button type="button" class="btn btn-primary" disabled="disabled">
                                    <span class="glyphicon glyphicon-floppy-disk" aria-hidden="true"></span>
                                </button>
                            </td>
                            <td class="edit-hapus-col">
                                <button class="btn btn-danger" type="button" data-toggle="modal" data-target="#konfHapusFaktur" onclick="passFakturInDb('@detailPiutang.NO')">
                                    <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
                                </button>
                            </td>
                        </tr>
                        iPd = iPd + 1;
                    }
                    <tr data-piutang-id="0">
                        @Html.HiddenFor(m => m.PiutangDetail.NO)
                        <td style="width: 130px; max-width: 130px;">
                            @*//change by nurul 22/4/2020*@
                            @*<div id="FAKTUR" class="selectivity-input" tabindex="0"></div>
                            @Html.HiddenFor(m => m.PiutangDetail.NFAKTUR)*@
                            @Html.TextBoxFor(m => m.PiutangDetail.NFAKTUR, new { @readonly = "readonly", placeholder = "Pilih Faktur", @style = "background-color : #eee; cursor :not-allowed;", @class = "form-control" })
                            <span class="input-group-btn">
                                <button id="tambah-faktur" class="btn btn-default" type="button" style="height: 34px;margin-right:0px;" disabled="disabled">
                                    <span class="glyphicon glyphicon-option-horizontal"></span>
                                </button>
                            </span>
                            @*//end change by nurul 22/4/2020*@
                        </td>
                        <td class="noref-piutang" style="text-align:right">
                            <span class="span-noref-piutang">-</span>
                            @Html.HiddenFor(m => m.PiutangDetail.NOREF)
                        </td>
                        <td class="tglref-piutang" style="text-align:right">
                            <span class="span-tglref-piutang"></span>
                            @Html.HiddenFor(m => m.PiutangDetail.TGL_REF)
                        </td>
                        <td class="sisa-piutang" style="text-align:right">
                            <span class="span-sisa-piutang">-</span>
                            @Html.HiddenFor(m => m.PiutangDetail.SISA)
                        </td>
                        <td class="bayar-piutang" style="text-align:right">
                            <span class="span-bayar-piutang">0,00</span>
                            @Html.TextBoxFor(m => m.PiutangDetail.BAYAR, new { Value = 0, @class = "form-control", type = "number", min = 0, step = 1, style = "display: none; text-align:right" })
                        </td>
                        <td class="potongan-piutang" style="text-align:right">
                            <span class="span-potongan-piutang">0,00</span>
                            @Html.TextBoxFor(m => m.PiutangDetail.POT, new { Value = 0, @class = "form-control", type = "number", min = 0, step = 1, style = "display: none; text-align:right" })
                        </td>
                        <td class="selisih-piutang" style="text-align:right">
                            <span class="span-selisih-piutang">0,00</span>
                            @{
                                var tempSelisih = (Model?.PiutangDetail?.SISA - Model?.PiutangDetail?.BAYAR - Model?.PiutangDetail?.POT);
                            }
                            @Html.TextBox("SELISIH", (tempSelisih >= 0 ? String.Format(CultureInfo.CreateSpecificCulture("id-id"), "{0:N}", tempSelisih) : "0,00"), new { @class = "form-control", @style = "display: none;text-align:right" })
                        </td>
                        <td class="lebihbayar-piutang" style="text-align:right">
                            <span class="span-lebihbayar-piutang">0,00</span>
                            @Html.TextBoxFor(m => m.PiutangDetail.LEBIH_BAYAR, new { Value = 0, @class = "form-control", type = "number", min = 0, step = 1, style = "display: none; text-align:right" })
                        </td>
                        <td class="persen-selisih" style="text-align:right">
                            <span class="span-persen-selisih">0 %</span>
                            @{
                                double? tempPersen = 0;
                                if (Model?.PiutangDetail?.LEBIH_BAYAR > 0)
                                {
                                    tempPersen = Model?.PiutangDetail?.LEBIH_BAYAR;
                                }
                                else if ((Model?.PiutangDetail?.SISA - Model?.PiutangDetail?.BAYAR - Model?.PiutangDetail?.POT) > 0 && (Model?.PiutangDetail?.SISA - Model?.PiutangDetail?.BAYAR - Model?.PiutangDetail?.POT) != null)
                                {
                                    tempPersen = ((Model?.PiutangDetail?.SISA - Model?.PiutangDetail?.BAYAR - Model?.PiutangDetail?.POT) / Model?.PiutangDetail.SISA * 100);
                                }
                            }
                            @Html.TextBox("PERSEN_SELISIH", tempPersen + " %", new { @class = "form-control", @style = "display: none;text-align:right" })
                        </td>
                        <td class="edit-hapus-col">
                            <button type="button" class="btn btn-primary" disabled="disabled" onclick="simpandetail('piu-0')">
                                <span class="glyphicon glyphicon-floppy-disk" aria-hidden="true"></span>
                            </button>
                        </td>
                        <td class="edit-hapus-col">
                            <button class="btn btn-danger" disabled="disabled" data-toggle="modal" data-target="#konfHapusFaktur">
                                <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
                            </button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

