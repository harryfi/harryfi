@using System.Globalization
@using PagedList.Mvc
@using MasterOnline.Models
@model PagedList.IPagedList<ATTRIBUTE_82CART_LIST>
@{
    string currentFilter = ViewBag.CurrentFilter;
    string currentSort = ViewBag.CurrentSort;
}
@section styles
{
    <style>

        #loading_prompt {
            display: none;
            width: 100%;
            height: 100%;
            position: fixed;
            z-index: 100;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            background-color: rgba(0,0,0,0);
        }

        #loading_prompt_image {
            width: 20px;
            height: 20px;
            margin-top: -90px;
            margin-left: -90px;
            position: absolute;
            top: 50%;
            left: 50%;
            border-width: 30px;
            border-radius: 50%;
        }
    </style>
}
<div id="loading_prompt">
    <div id="loading_prompt_image">
        <img src="~/Content/Images/spinner.gif" />
    </div>
</div>
<input id="txt_last_page" type="hidden" class="form-control" value="@ViewData["LastPage"]">
<div id="div_table_prompt" style="width:100%">
    <table class="table table-striped table-bordered table-hover">
        <thead>
            <tr role="row">
                <th class="sorting text-center" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" aria-label="Status: activate to sort column ascending" style="width: 40px; max-width: 40px; border-right:hidden; align-self:flex-start"><input type="checkbox" class="dt-checkboxes-select-all center" id="checkbox_all_gntstatus_attribute" style="margin-top: 20px; border-right:hidden; align-self:flex-start; width:30px; height:28px;" /></th>
                <th class="sorting" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" aria-label="Salary: activate to sort column ascending" style="width: 50px; max-width: 50px;">Pilih</th>
                <th class="sorting_asc" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" aria-sort="ascending" aria-label="Picture: activate to sort column descending" style="width: 100%;">Attribute</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model)
            {
            <tr>
                <td class="edit-hapus-col">
                    @*<button class="btn btn-primary" data-value="@item.id_attribute" data-valuename="@item.attribute_name" onclick="pilihPrompt(this)">
            <span class="glyphicon glyphicon-check" aria-hidden="true"></span>
        </button>*@
                    <input type="checkbox" class="dt-checkboxes center checkbox_gntstatus_attribute" data-attribute="@item.id_attribute" data-attributename="@item.attribute_name" style="border-left:hidden; align-self:flex-start; width:30px; height:28px;" />
                </td>
                <td style="width: 40px; max-width: 40px; align-self:flex-start; border-left:hidden">
                </td>
                <td>@item.attribute_name <button type="button" id="save_prompt_btn" class="btn btn-success" onclick="pilihPrompt(this)">
    Simpan
</button></td>
            </tr>
            }
        </tbody>
    </table>
</div>
@if (Model.PageCount > 1)
{
    <div id="tabelpromptpartialpager" class="pager">
        @Html.PagedListPager(Model, page => Url.Action("RefreshAttribute82Cart", new
   {
       attribute = ViewData["attribute"],
       cust = ViewData["cust"],
       page,
       search = ViewData["searchParam"]
   }),
        new PagedListRenderOptions
        {
            LinkToFirstPageFormat = "<<",
            LinkToPreviousPageFormat = "prev",
            LinkToNextPageFormat = "next",
            LinkToLastPageFormat = ">>",
            DisplayEllipsesWhenNotShowingAllPageNumbers = false
        })
        Page @(Model.PageCount < Model.PageNumber ? 0 : Model.PageNumber) of @Model.PageCount
    </div>
}
<script type="text/javascript">
    $(function () {
        $('#tabelpromptpartialpager').on('click', 'a', function () {
            if (this.href != "") {
                $.ajax({
                    url: this.href,
                    type: 'GET',
                    cache: false,
                    beforeSend: function () {
                        $('#div_table_prompt').hide();
                        $('#loading_prompt').show();
                    },
                    success: function (response) {
                        $('#divPartial').html(response);
                        $('#loading_prompt').hide();
                        $('#div_table_prompt').show();
                    }
                });
                return false;
            }
        });
    });

    $("#checkbox_all_gntstatus_attribute").click(function () {
        $(".checkbox_gntstatus_attribute").prop('checked',
            $(this).prop('checked'));
    });

    function pilihPrompt(sender) {
        var rows_selected = [];
        var rows_selected_name = [];

        $('.checkbox_gntstatus_attribute').each(function (i, item) {
            //if ($('#checkbox_all_gntstatus_sudahdibayar').is(":checked")) {
            //    rows_selected.push($(item).attr("data-recnum"));
            //} else
            if ($(item).is(":checked")) {
                rows_selected.push($(item).attr("data-attribute"));
                rows_selected_name.push($(item).attr("data-attributename"));
            }
        });

        let value = $(sender).attr('data-value');
        let name = $(sender).attr('data-valuename');
        self.window.close();
        window.onunload = refreshTextBox;
        function refreshTextBox() {
            window.opener.afterPromptAttribute82Cart(value.toString(), name.toString(), rows_selected, rows_selected_name);
        }
    }
</script>