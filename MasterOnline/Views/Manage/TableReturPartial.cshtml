@using System.Globalization
@model MasterOnline.ViewModels.FakturViewModel
<table id="datatable" class="table table-striped table-bordered dataTable" role="grid" aria-describedby="datatable_info">
    <thead>
        <tr role="row">
            <th class="sorting_asc" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" aria-sort="ascending" aria-label="Name: activate to sort column descending" style="width: 130px;">No. Bukti</th>
            <th class="sorting" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" aria-label="Position: activate to sort column ascending" style="width: 100px;">Tanggal Retur</th>
            <th class="sorting" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" style="width: 100px;">No. Faktur</th>
            <th class="sorting" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" aria-label="Office: activate to sort column ascending" style="width: 117px;">Marketplace</th>
            <th class="sorting" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" aria-label="Age: activate to sort column ascending" style="width: 90px;">Pembeli</th>
            <th class="sorting" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" aria-label="Start date: activate to sort column ascending" style="width: 115px;">Total</th>
            <th class="sorting" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" aria-label="Start date: activate to sort column ascending" style="width: 60px;">Posting</th>
            <th class="sorting" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" aria-label="Salary: activate to sort column ascending" style="width: 50px; max-width: 50px;">Edit</th>
            <th class="sorting" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" aria-label="Status: activate to sort column ascending" style="width: 50px; max-width: 50px;">Hapus</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var faktur in Model.ListFaktur)
        {
            var buyer = Model.ListPembeli.Single(m => m.BUYER_CODE == faktur.PEMESAN);
            var pelanggan = Model.ListPelanggan.FirstOrDefault(m => m.CUST == faktur.CUST);
            var idMarket = 0;
            if (pelanggan != null)
            {
                idMarket = Convert.ToInt32(pelanggan.NAMA);
            }
            var market = Model.ListMarketplace.FirstOrDefault(m => m.IdMarket == idMarket);
            var NamaMarket = "";
            if (market != null)
            {
                NamaMarket = market.NamaMarket;
            }
            var nFaktur = Model.ListNFaktur.SingleOrDefault(n => n.NFAKTUR == faktur.NO_BUKTI);
        <tr>
            <td>@faktur.NO_BUKTI</td>
            <td>@(faktur.TGL.ToString("dd/MM/yyyy"))</td>
            <td>@faktur.NO_REF</td>
            @*<td>@NamaMarket</td>*@
            <td>@(NamaMarket + " (" + pelanggan.PERSO + ")")</td>
            <td>
                @*remark by nurul 24/9/2018 @(buyer.NAMA + " (" + buyer.PERSO + ")")*@
                @*@(buyer.NAMA + " (" + pelanggan.PERSO + ")")*@
                @*@buyer.NAMA*@ 
                @faktur.NAMAPEMESAN
            </td>
            <td style = "text-align:right">@String.Format(CultureInfo.CreateSpecificCulture("id-id"), "{0:N}", faktur.NETTO)</td>
            @if (Convert.ToString(faktur.ST_POSTING) == "Y")
            {
                <td>
                    Sudah
                </td>
            }
            else
            {
                <td>
                    Belum
                </td>
            }
            <td class="edit-hapus-col">
                @if (Convert.ToString(faktur.ST_POSTING) == "Y")
                {
                    <!-- Kalau faktur hasil generate dari pesanan tidak boleh diubah -->
                    <button class="btn btn-primary" onclick="lihatFaktur(@faktur.RecNum)">
                        <span class="glyphicon glyphicon-eye-open" aria-hidden="true"></span>
                    </button>
                }
                else
                {
                    <button class="btn btn-primary" disabled="@(nFaktur != null)" onclick="editFaktur1(@faktur.RecNum)">
                        <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
                    </button>
                }
            </td>
            <td class="edit-hapus-col">
                @if (Convert.ToString(faktur.ST_POSTING) == "Y")
                {
                    <button class="btn btn-danger" onclick="undeleteableFaktur()">
                        <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
                    </button>
                }
                else
                {
                    <button class="btn btn-danger" disabled="@(nFaktur != null)" data-toggle="modal" data-target="#konfHapusFaktur" onclick="pass(@faktur.RecNum)">
                        <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
                    </button>
                }

            </td>
        </tr>
        }
    </tbody>
</table>
