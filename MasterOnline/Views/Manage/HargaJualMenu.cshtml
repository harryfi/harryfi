@using System.Globalization
@using MasterOnline.ViewModels
@model HargaJualViewModel
@{
    ViewBag.Title = "Harga Jual Barang";
    Layout = "~/Views/Shared/_LayoutManage.cshtml";
    var dataSession = Session["SessionInfo"] as AccountUserViewModel;
    var username = "";
    var context = new MoDbContext("");
    if (dataSession?.User != null)
    {
        var accId = context.User.Single(u => u.Email == dataSession.User.Email).AccountId;
        username = context.Account.Single(a => a.AccountId == accId).Username;
        //context.Dispose();
    }
    else
    {
        username = dataSession?.Account.Username;
    }
    if (username.Length > 20)
    {
        username = username.Substring(0, 17) + "...";
    }
}
@section styles
{
    <link href="~/Content/build/css/bootstrap-datepicker.min.css" rel="stylesheet" />
    <link href="~/Content/selectize.css" rel="stylesheet" />
    <link href="~/Content/build/css/selectivity-jquery.min.css" rel="stylesheet" />
    <link href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,600" rel="stylesheet" />
    <style>
        #hargaJual-section > div {
            background-color: #fff;
            padding: 20px;
        }

        #HargaJuals_AL {
            resize: vertical;
            height: 100px;
            max-height: 100px;
        }

        #hapus_label {
            color: orange;
            font-weight: bold;
        }

        @@media screen and (max-width: 767px) {
            .edthargajualmdl {
                width: 43%
            }

            .brgtblhrgajb {
                margin-left: 10px;
            }

            .marginmin {
                margin-left: 0px;
            }

            #hargaJual-section > div {
                padding: 2px;
                width: 87%;
                margin-left: 20px;
            }

            .dataTables_paginate {
                margin-top: 9px;
            }
        }
    </style>
}
<style>
    #loading_spinner_btnBlibli {
        display: none;
        width: 100%;
        height: 100%;
        position: fixed;
        z-index: 100;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        background-color: rgba(0,0,0,0);
    }

    #loading_spinner_image_btnBlibli {
        width: 20px;
        height: 20px;
        margin-top: -90px;
        margin-left: -90px;
        position: absolute;
        top: 50%;
        left: 50%;
        border-width: 30px;
        border-radius: 50%;
    }

    #loading_spinner_btn82Cart {
        display: none;
        width: 100%;
        height: 100%;
        position: fixed;
        z-index: 100;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        background-color: rgba(0,0,0,0);
    }

    #loading_spinner_image_btn82Cart {
        width: 20px;
        height: 20px;
        margin-top: -90px;
        margin-left: -90px;
        position: absolute;
        top: 50%;
        left: 50%;
        border-width: 30px;
        border-radius: 50%;
    }

    [data-tip] {
        position: relative;
    }

        [data-tip]:before {
            content: '';
            /* hides the tooltip when not hovered */
            display: none;
            content: '';
            border-left: 5px solid transparent;
            border-right: 5px solid transparent;
            border-bottom: 5px solid #1a1a1a;
            position: absolute;
            top: 30px;
            /*left: 35px;*/
            z-index: 8;
            font-size: 0;
            line-height: 0;
            /*width: 0;
                height: 0;*/
            margin-left: 0px;
            left: 50%;
        }

        [data-tip]:after {
            display: none;
            content: attr(data-tip);
            position: absolute;
            top: 35px;
            /*left: 0px;*/
            padding: 2px 5px;
            background: #1a1a1a;
            color: #fff;
            z-index: 9;
            font-size: 0.85em;
            height: auto;
            line-break: normal;
            max-width: 300px;
            line-height: 18px;
            -webkit-border-radius: 3px;
            -moz-border-radius: 3px;
            border-radius: 3px;
            white-space: normal;
            word-wrap: normal;
            left: 30px;
            margin-left: -50px;
            width: 68px;
        }

        [data-tip]:hover:before,
        [data-tip]:hover:after {
            display: block;
        }
</style>

        <div class="row" id="hargaJual-section">
            <div class="col-lg-12 col-md-12">
                <div class="row hargaJual_table_section marginmin">
                    <div class="col-lg-8 col-sm-6">
                        <div class="input-group">
                            <label class="col-lg-1 col-sm-4" style="padding-top:5px; margin-right:8px;">Search</label>
                            <div class="col-lg-4 col-sm-4">
                                <select class="form-control" id="filter_pencarian_field" required="required">
                                    <option value="kodebarang">Kode Barang</option>
                                    <option value="namabarang">Nama Barang</option>
                                </select>
                            </div>
                            <div class="col-lg-5 col-sm-6">
                                <input id="search_hargaJual" type="text" class="form-control" placeholder="Ketik Pencarian">
                            </div>
                            <div class="col-lg-1 col-sm-6">
                                <span class="input-group-btn">
                                    <button type="button" id="search_hargaJual_click" class="btn btn-primary">
                                        <i class="fa fa-search"></i>
                                    </button>
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4 col-sm-6">
                        <div class="pull-right">
                            @*<button type="button" class=" btn btn-default" data-style="expand-right">
                                    <span>Refresh</span>
                                </button>*@
                            <button type="button" onclick="exportExcel()" class=" btn btn-primary" data-style="expand-right">
                                <span>Export ke Excel</span>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="row hargaJual_table_section">
                    <div class="col-sm-12" id="table-hargaJual-partial">
                        @*@Html.Partial("TableHargaJualPartial")*@
                    </div>
                </div>
            </div>
        </div>



<!-- Modal Hapus hargaJual -->
<div class="modal fade" id="konfHapusHargaJual" tabindex="-1" role="dialog" aria-labelledby="konfirmasiHapusLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="konfirmasiHapusLabel">Konfirmasi</h4>
            </div>
            <div class="modal-body">
                <div class="row text-center">
                    <h4>Apakah Anda yakin ingin menghapus akun penghubung marketplace <span id="hapus_label"></span>?</h4>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" data-dismiss="modal">Tidak</button>
                <button type="button" class="btn btn-success" onclick="deletehargaJual()">Ya</button>
            </div>
        </div>
    </div>
</div>
<!-- Modal Edit Harga Jual -->
<div class="modal fade" id="modalEditHargaJual" tabindex="-1" role="dialog" aria-labelledby="editHargaJualLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content edthargajualmdl">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="editHargaJualLabel">Edit Harga Jual</h4>
            </div>
            <div class="modal-body" id="modal-gudang-qty-body">
                <div class="row">
                    <div class="col-md-6">
                        <p id="kodeBarang">-</p>
                        <p id="namaBarang">-</p>
                        <p id="labelAkunMp">-</p>
                        <p>Harga jual awal: Rp <span id="hJualAwal"></span></p>
                    </div>
                    <div class="col-md-6">
                        <b>Masukkan harga jual yang baru:</b>
                        <input type="text" id="HJUALBARU" name="HJUALBARU" class="form-control" style="margin-top: 10px;" />
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button onclick="saveHargaJualBaru();" id="btnUbahHJual" type="button" class="btn btn-success">Simpan</button>
                <div id="loading_spinner_btn">
                    <div id="loading_spinner_image_btn">
                        <img id="spinner_btn" src="~/Content/Images/spinner.gif" />
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal Edit Harga Jual Blibli -->
<div class="modal fade" id="modalEditHargaJualBlibli" tabindex="-1" role="dialog" aria-labelledby="editHargaJualLabelBlibli">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="editHargaJualLabelBlibli">Edit Harga Jual & Promosi Blibli</h4>
            </div>
            <div class="modal-body" id="modal-gudang-qty-body">
                <div class="row">
                    <div class="col-md-6">
                        <p id="kodeBarangBlibli">-</p>
                        <p id="namaBarangBlibli">-</p>
                        <p id="labelAkunMpBlibli">-</p>
                        <p>Harga jual awal: Rp <span id="hJualAwalBlibli"></span></p>
                        <p>Harga Promosi awal: Rp <span id="hJualPromosiAwalBlibli"></span></p>
                    </div>
                    <div class="col-md-6">
                        <div class="row">
                            <div class="col-m12">
                                <b>Masukkan harga jual yang baru:</b>
                                <input type="text" id="HJUALBARUBlibli" name="HJUALBARUBlibli" class="form-control" style="margin-top: 10px;" />
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-m12">
                                <b>Masukkan harga promosi yang baru:</b>
                                <input type="text" id="HJUALPROMOSIBARUBlibli" name="HJUALPROMOSIBARUBlibli" class="form-control" style="margin-top: 10px;" />
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button onclick="saveHargaJualBaruBlibli();" id="btnUbahHJualBlibli" type="button" class="btn btn-success">Simpan</button>
                <div id="loading_spinner_btnBlibli" style="display:none">
                    <div id="loading_spinner_image_btnBlibli">
                        <img id="spinner_btnBlibli" src="~/Content/Images/spinner.gif" />
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal Edit Harga Jual 82Cart -->
<div class="modal fade" id="modalEditHargaJual82Cart" tabindex="-1" role="dialog" aria-labelledby="editHargaJualLabel82Cart">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="editHargaJualLabel82Cart">Edit Harga Jual</h4>
            </div>
            <div class="modal-body" id="modal-gudang-qty-body">
                <div class="row">
                    <div class="col-md-6">
                        <p id="kodeBarang82Cart">-</p>
                        <p id="namaBarang82Cart">-</p>
                        <p id="labelAkunMp82Cart">-</p>
                        <p>Harga Jual awal: Rp <span id="hJualAwal82Cart"></span></p>
                        <p>Harga Jual Barang Induk: Rp <span id="hJualInduk82Cart"></span></p>
                        @*<p>Harga Grosir awal: Rp <span id="hJualGrosirAwal82Cart"></span></p>*@
                    </div>
                    <div class="col-md-6">
                        <div class="row">
                            <div class="col-m12">
                                <b>Masukkan harga jual baru:</b>
                                <input type="text" id="HJUALBARU82Cart" name="HJUALBARU82Cart" value="27000" class="form-control" style="margin-top: 10px;" />
                                <input type="hidden" id="HJUALBARU82CartTemp" name="HJUALBARU82CartTemp" disabled="disabled" class="form-control" style="margin-top: 10px;" />
                            </div>
                        </div>
                        <div class="row" style="margin-top: 10px;">
                            <div class="col-m12">
                                <b>Dampak (+/-) harga jual baru dengan lama :</b>
                                <input type="text" id="HJUALBARU82CartDampak" name="HJUALBARU82CartDampak" disabled="disabled" class="form-control" style="margin-top: 10px;" />
                            </div>
                        </div>
                        @*<div class="row">
                                <div class="col-m12">
                                    <b>Masukkan harga grosir yang baru:</b>
                                    <input type="text" id="HJUALPROMOSIBARU82Cart" name="HJUALPROMOSIBARU82Cart" class="form-control" style="margin-top: 10px;" />
                                </div>
                            </div>*@
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button onclick="saveHargaJualBaru82Cart();" id="btnUbahHJual82Cart" type="button" class="btn btn-success">Simpan</button>
                <div id="loading_spinner_btn82Cart" style="display:none">
                    <div id="loading_spinner_image_btn82Cart">
                        <img id="spinner_btn82Cart" src="~/Content/Images/spinner.gif" />
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- add by fauzi 14 Juli 2020 for detail harga beli terakhir -->
<div class="modal fade" id="modalDetailHargaBeliTerakhir" style="margin:0;padding:0;" tabindex="-1" role="dialog" aria-labelledby="modalDetailHargaBeliTerakhirLabel">
    <div class="modal-dialog" role="document" style="margin:auto;width:700px;margin-top:20px;">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="modalDetailHargaBeliTerakhirLabel">Detail Harga Beli</h4>

                <div class="row">
                    <div class="form-group" style="margin-top: 5px;">
                        <label class="control-label col-md-3 col-sm-3">Kode Barang</label>
                        <div class="col-md-3 col-sm-3">
                            @Html.TextBox("kd-brg-hargabeliterakhir", "", new { @class = "form-control", disabled = "disabled" })
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="form-group" style="margin-top: 5px;">
                        <label class="control-label col-md-3 col-sm-3">Nama Barang</label>
                        <div class="col-md-8 col-sm-8">
                            @Html.TextArea("nm-brg-hargabeliterakhir", "", new { @class = "form-control", disabled = "disabled" })
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="form-group" style="margin-top: 5px;">
                        <label class="control-label col-md-3 col-sm-3">Qty Stok</label>
                        <div class="col-md-3 col-sm-3">
                            <label id="ttl-qty-stok" class="control-label" disabled="disabled"></label>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="form-group" style="margin-top: 5px;">
                        <label class="control-label col-md-3 col-sm-3">Average Harga Pokok</label>
                        <div class="col-md-3 col-sm-3">
                            <label id="ttl-average" class="control-label" disabled="disabled"></label>
                        </div>
                    </div>
                </div>
                @*<div class="row">
            <div class="form-group" style="margin-top: 5px;">
                <label class="control-label col-md-3 col-sm-3">Periode 3 bulan terakhir</label>
                <div class="col-md-3 col-sm-3">
                        <label id="ttl-periode" class="control-label" disabled="disabled"></label>
                    </div>
            </div>
        </div>*@
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-lg-4 col-sm-6" style="margin-bottom:7px;">
                        <div class="input-group">
                            <input id="search_detail_hargabeliterakhir" type="text" class="form-control" placeholder="Pencarian">
                            <span class="input-group-btn">
                                <button type="button" id="search_detail_hargabeliterakhir_click" class="btn btn-primary">
                                    <i class="fa fa-search"></i>
                                </button>
                            </span>
                        </div>
                    </div>
                    <div class="col-lg-8 col-sm-6" style="margin-bottom:7px;">
                        <div class="nav navbar-right panel_toolbox">
                            <h5><span class="label label-success" style="color:white">3 Bulan Terakhir</span></h5>
                        </div>
                    </div>
                </div>
                <div id="list-detail-hargabeliterakhir"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" id="close-detail-hargabeli" data-dismiss="modal">Tutup</button>
            </div>
        </div>
    </div>
</div>
<!-- end by fauzi 14 Juli 2020 -->
@section scripts
{
    <script src="~/Content/selectize.js" type="text/javascript"></script>
    <script src="~/Content/build/js/selectivity-jquery.min.js" type="text/javascript"></script>
    <script src="~/Content/build/js/bootstrap-datepicker.min.js" type="text/javascript"></script>
    <script type="text/javascript">
        //add by nurul 12/2/2019
        var $page = window.text;
        //end add by nurul 12/2/2019
        var $recNum = 0;
        var $TabAktif = 0;
        var tempBrg = "";
        var tempNama = "";

        $(document).on('ready',
            function () {
                //add by nurul 12/2/2019
                $page = 0;
            //end add by nurul 12/2/2019
                //Initialize();
                var filterBy = "kodebarang";
                refreshTableHargaJual("");
                //add by nurul 12/2/2019
                //$('#datatable').on('page.dt', function () {
                //    $page = $('#datatable').DataTable().page.info().page;
                //});
                //$('#datatable').DataTable().page($page).draw(false);
                    //end add by nurul 12/2/2019



                $('#search_hargaJual').keypress(function (e) {
                    var key = e.which;
                    if (key == 13)// the enter key code
                    {
                        searchTableHargaJual(filterBy);
                        return false;
                    }
                });
                $('#search_hargaJual_click').click(function () {
                    searchTableHargaJual(filterBy);
                });

                //add by fauzi 12 Mei 2020
                $('#filter_pencarian_field').change(function () {
                    filterBy = $(this).val();
                    switch (filterBy) {
                        case "kodebarang":
                            filterBy = "kodebarang";
                            //searchTablePesanan(filterBy);
                            break;
                        case "namabarang":
                            filterBy = "namabarang";
                            //searchTablePesanan(filterBy);
                            break;
                        default:
                            break;
                    }

                });


                $('#HJUALBARU82Cart').change(function () {
                    var hargaInput = parseInt($(this).val());
                    var hargaAwal = parseInt($('#HJUALBARU82CartTemp').val());
                    var hargaAkhir = "";
                    var kondisi = (hargaInput > hargaAwal) ? true : false;
                    if (kondisi) {
                        hargaAkhir = (hargaInput - hargaAwal);
                        var adaMin = " " + hargaAkhir;
                        adaMin = adaMin.substr(0, 2);
                        if (adaMin == " -") {
                            hargaAkhir = hargaAkhir;
                        } else {
                            hargaAkhir = "+" + hargaAkhir;
                        }
                    } else {
                        hargaAkhir = (hargaAwal - hargaInput);
                        var adaMin2 = " " + hargaAkhir;
                        adaMin2 = adaMin2.substr(0, 2);
                        if (adaMin2 == " -") {
                            hargaAkhir = hargaAkhir;
                        } else {
                            hargaAkhir = "-" + hargaAkhir;
                        }
                    }

                    $('#HJUALBARU82CartDampak').val(hargaAkhir);

                });

            });
        //add by Tri, 27 Mei 2019
        function exportExcel() {
            var link = '@Html.Raw(Url.Action("HargaJualtoExcel", "TransferExcel"))';

            $.ajax({
                type: "GET",
                url: link,
                contentType: 'application/json',
                cache: false,
                async: false,
                beforeSend: function () {
                    $('#loading_spinner_btn').show();
                },
                success: function (response) {
                    $('#loading_spinner_btn').hide();
                    if (response.Errors.length == 0) {

                        @*var url2 = '@Url.Action("DownloadFileExcel", "TransferExcel", new { file = "replace1", fileName = "replace2" })';
                        url2 = url2.replace("replace1", response.byteExcel);
                        url2 = url2.replace("replace2", response.namaFile);

                        window.location = url2;*@
                        //downloadXcel(response);
                        //var sampleArr = base64ToArrayBuffer(response.byteExcel);
                        var bytes = new Uint8Array(response.byteExcel);
                        saveByteArray(response.namaFile, bytes);

                    } else {
                        alert(response.Errors[0]);
                    }
                    //var response = JSON.parse(data);
                    //window.location = '/Download?fileGuid=' + response.FileGuid
                    //    + '&filename=' + response.FileName;
                    //window.location = '/Download?file=' + data;
                },
                error: function (xhr) {
                    $('#loading_spinner_btn').hide();
                    console.log(xhr);
                }
            });

        }

        $('#search_detail_hargabeliterakhir').keypress(function (e) {
            var key = e.which;
            if (key == 13)// the enter key code
            {
                searchTableDetailHargaBeli();
                return false;
            }
        });
        $('#search_detail_hargabeliterakhir_click').click(function () {
            searchTableDetailHargaBeli();
        });

        $('#close-detail-hargabeli').click(function () {
            tempBrg = "";
            tempNama = "";
        });

        function searchTableDetailHargaBeli() {
            if (tempBrg != null && tempBrg != undefined && tempBrg != "") {
            var link = '@Html.Raw(Url.Action("LihatDetailHargaBeliTerakhir", "Manage", new { kodebarang = "replaceID", search = "replaceSearch" }))';
            link = link.replace("replaceID", encodeURIComponent(tempBrg));
                link = link.replace("replaceSearch", encodeURIComponent($('#search_detail_hargabeliterakhir').val()));

            $.ajax({
                type: "GET",
                url: link,
                beforeSend: function () {
                    $('#list-detail-hargabeliterakhir').hide();
                    $('#loading_hargaJual_tab').show();
                },
                success: function (response) {
                    $('#list-detail-hargabeliterakhir').html(response);
                    $('#loading_hargaJual_tab').hide();
                    $('#list-detail-hargabeliterakhir').show();
                },
                error: function (xhr, status, error) {
                    $('#loading_hargaJual_tab').hide();
                    console.log(error);
                }
                });
            } else {
                $('#loading_hargaJual_tab').hide();
                alert("Tidak ada detail.");
            }
        }

        function LihatDetailHargaBeliTerakhir($req_id) {
            if ($req_id != null && $req_id != undefined && $req_id != "") {
                var tempReqId = $req_id.split('|');
                tempBrg = tempReqId[0];
                tempNama = tempReqId[1];
                var tempStokQty = tempReqId[2];
                $('#search_detail_hargabeliterakhir').val('');
                $('#txt_last_page_detail_hargabeliterakhir').val('');

                var $link = '@Html.Raw(Url.Action("LihatDetailHargaBeliTerakhir", "Manage", new { kodebarang = "replaceID", page = "replaceLastPage", search = "replaceSearch" }))';
                $link = $link.replace("replaceID", encodeURIComponent(tempBrg));
            $link = $link.replace("replaceSearch", encodeURIComponent($('#search_detail_hargabeliterakhir').val()));
            $link = $link.replace("replaceLastPage", encodeURIComponent($('#txt_last_page_detail_hargabeliterakhir').val()));

        $.ajax({
            type: "GET",
            url: $link,
            beforeSend: function () {
                $('#list-detail-hargabeliterakhir').hide();
                $('#loading_hargaJual_tab').show();
                $('#kd-brg-hargabeliterakhir').val(tempBrg);
                $('#nm-brg-hargabeliterakhir').text(tempNama);
                $('#ttl-qty-stok').val(": " + tempStokQty);
            },
            success: function (value) {
                $('#list-detail-hargabeliterakhir').html(value);
                $('#loading_hargaJual_tab').hide();
                $('#list-detail-hargabeliterakhir').show();
            },
            error: function (xhr, status, error) {
                $('#loading_hargaJual_tab').hide();
                alert(error);
                console.log(error);
            }
            });
        } else {
                $('#loading_hargaJual_tab').hide();
            alert("Tidak ada detail Harga Beli Terakhir.");
        }
        }

        function base64ToArrayBuffer(base64) {
            var binaryString = window.atob(base64);
            var binaryLen = binaryString.length;
            var bytes = new Uint8Array(binaryLen);
            for (var i = 0; i < binaryLen; i++) {
                var ascii = binaryString.charCodeAt(i);
                bytes[i] = ascii;
            }
            return bytes;
        }

        function saveByteArray(reportName, byte) {
            var blob = new Blob([byte], { type: "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet" });
            var link = document.createElement('a');
            link.href = window.URL.createObjectURL(blob);
            var fileName = reportName;
            link.download = fileName;
            link.click();
        };

        function downloadXcel(value) {
            //var dataPost = new FormData();
            //dataPost.append("data", value);
            var dataPost = {
                data: JSON.stringify(value)
            }

            $.ajax({
                type: "POST",
                url: '@Url.Action("DownloadFileExcel", "TransferExcel")',
                contentType: "application/json;charset=utf-8",
                data: dataPost,
                //dataType: "json",
                async: true,
                //processData: false,  // tell jQuery not to process the data
                //contentType: false,  // tell jQuery not to set contentType
                beforeSend: function () {
                    //$('#loading_spinner').show();
                },
                success: function (response) {
                    if (response.Errors == null) {

                    }
                },
                error: function (xhr, status, error) {
                    console.log(error);
                    //$('#loading_spinner').hide();
                }
            });
            return null
        }
        //end add by Tri, 27 Mei 2019

        function Initialize() {
            //var table = $('#datatable').DataTable();

            //$('#search_hargaJual').keyup(function () {
            //    table.search($(this).val()).draw();
            //});
            $('#search_hargaJual').keypress(function (e) {
                var key = e.which;
                if (key == 13)// the enter key code
                {
                    searchTableHargaJual();
                    return false;
                }
            });
            $('#search_hargaJual_click').click(function () {
                searchTableHargaJual();
            });

            //add by nurul 26 nov 2018, setelah di close, search lg
            //table.search($('#search_hargaJual').val()).draw();
            //end add by nurul 26 nov 2018, setelah di close, search lg
            //add by nurul 12/2/2019
            //$('#datatable').on('page.dt', function () {
            //    $page = $('#datatable').DataTable().page.info().page;
            //});
            //$('#datatable').DataTable().page($page).draw(false);
                    //end add by nurul 12/2/2019
        }

        function pass(recNum, kdBrg, nmBrg, nmMp, hjual) {
            $recNum = recNum;
            $('#kodeBarang').text(kdBrg);
            $('#namaBarang').text(nmBrg);
            $('#labelAkunMp').text(nmMp);
            $('#hJualAwal').text(hjual);
            $('#HJUALBARU').val('');
        }
        function passBlibli(recNum, kdBrg, nmBrg, nmMp, hjual, hpromosi) {
            $recNum = recNum;
            $('#kodeBarangBlibli').text(kdBrg);
            $('#namaBarangBlibli').text(nmBrg);
            $('#labelAkunMpBlibli').text(nmMp);
            $('#hJualAwalBlibli').text(hjual);
            $('#hJualPromosiAwalBlibli').text(hpromosi);

            $('#HJUALBARUBlibli').val('');
            $('#HJUALPROMOSIBARUBlibli').val('');
        }

        function pass82Cart(recNum, kdBrg, nmBrg, nmMp, hjual, hjualasli) {
            var link = '@Html.Raw(Url.Action("GetHargaInduk82Cart", "Manage", new { kodebrg = "replaceKodeBarang" }))';
            link = link.replace("replaceKodeBarang", encodeURIComponent(kdBrg));
            $.ajax({
                type: "GET",
                url: link,
                contentType: 'application/json',
                cache: false,
                beforeSend: function () {
                    //$('#loading_spinner_btn82Cart').show();
                },
                success: function (res) {
                    if (res.success) {
                        $('#hJualInduk82Cart').text(res.hargaInduk);
                        $('#HJUALBARU82CartTemp').val(res.hargaInduk);
                    } else {
                        alert("Gagal ambil data harga Induk.");
                    }

                },
                error: function (xhr) {
                    console.log(xhr);
                }
            });


            $recNum = recNum;
            $('#kodeBarang82Cart').text(kdBrg);
            $('#namaBarang82Cart').text(nmBrg);
            $('#labelAkunMp82Cart').text(nmMp);
            $('#hJualAwal82Cart').text(hjual);
            $('#hJualGrosirAwal82Cart').text(hjualasli);

            $('#HJUALBARU82Cart').val('');
            $('#HJUALPROMOSIBARU82Cart').val('');

            //add by fauzi for edit harga jual barang 82Cart
            $('#HJUALBARU82CartDampak').val('');
            //end add
        }

        function saveHargaJualBaruBlibli() {
            var link = '@Html.Raw(Url.Action("UbahHargaJualBlibli", "Manage", new { recNum = "replaceRecNum", hargaJualPromosiBaru = "replaceHargaPromosiBaru", hargaJualIndukBaru = "replaceHargaBaru" }))';
            link = link.replace("replaceRecNum", encodeURIComponent($recNum));
            link = link.replace("replaceHargaBaru", encodeURIComponent($('#HJUALBARUBlibli').val()));
            link = link.replace("replaceHargaPromosiBaru", encodeURIComponent($('#HJUALPROMOSIBARUBlibli').val()));
            var filterBy = encodeURIComponent($('#filter_pencarian_field').val());
            //var filterBy = "";

            $.ajax({
                type: "GET",
                url: link,
                contentType: 'application/json',
                cache: false,
                beforeSend: function () {
                    $('#btnUbahHJualBlibli').hide();
                    $('#loading_spinner_btnBlibli').show();
                },
                success: function (res) {
                    $('#btnUbahHJualBlibli').show();
                    $('#loading_spinner_btnBlibli').hide();
                    if (res.message == null) {
                        refreshTableHargaJual(filterBy);
                        alert("Harga jual berhasil diubah");
                        $('#table-hargaJual-partial').html(res);
                        //Initialize();

                        $('#modalEditHargaJualBlibli').modal('hide');
                    } else {
                        alert(res.message);
                    }

                },
                error: function (xhr) {
                    $('#btnUbahHJualBlibli').show();
                    $('#loading_spinner_btnBlibli').hide();
                    console.log(xhr);
                }
            });
        }

        function saveHargaJualBaru82Cart() {
            var link = '@Html.Raw(Url.Action("UbahHargaJual82Cart", "Manage", new { recNum = "replaceRecNum", hargaJualDampakBaru = "replaceHargaDampakBaru", hargaJualIndukBaru = "replaceHargaBaru"}))';
            link = link.replace("replaceRecNum", encodeURIComponent($recNum));
            link = link.replace("replaceHargaBaru", encodeURIComponent($('#HJUALBARU82Cart').val()));
            //diremark karena untuk mengubah price dasar saja
            //link = link.replace("replaceHargaGrosirBaru", encodeURIComponent($('#HJUALPROMOSIBARU82Cart').val()));
            //link = link.replace("replaceHargaGrosirBaru", encodeURIComponent($('#HJUALBARU82Cart').val())); //remark by fauzi
            var hargaDampak = $('#HJUALBARU82CartDampak').val();
            link = link.replace("replaceHargaDampakBaru", encodeURIComponent(hargaDampak.replace("+", "")));
            var filterBy = encodeURIComponent($('#filter_pencarian_field').val());
            //var filterBy = "";

            $.ajax({
                type: "GET",
                url: link,
                contentType: 'application/json',
                cache: false,
                beforeSend: function () {
                    $('#btnUbahHJual82Cart').hide();
                    $('#loading_spinner_btn82Cart').show();
                },
                success: function (res) {
                    $('#btnUbahHJual82Cart').show();
                    $('#loading_spinner_btn82Cart').hide();
                    if (res.message == null) {
                        refreshTableHargaJual(filterBy);
                        alert("Harga jual berhasil diubah");
                        $('#table-hargaJual-partial').html(res);
                        //Initialize();

                        $('#modalEditHargaJual82Cart').modal('hide');
                    } else {
                        alert(res.message);
                    }

                },
                error: function (xhr) {
                    $('#btnUbahHJual82Cart').show();
                    $('#loading_spinner_btn82Cart').hide();
                    console.log(xhr);
                }
            });
        }

        function saveHargaJualBaru() {
            var link = '@Html.Raw(Url.Action("UbahHargaJual", "Manage", new { recNum = "replaceRecNum", hargaJualBaru = "replaceHargaBaru" }))';
            link = link.replace("replaceRecNum", encodeURIComponent($recNum));
            link = link.replace("replaceHargaBaru", encodeURIComponent($('#HJUALBARU').val()));
            var filterBy = encodeURIComponent($('#filter_pencarian_field').val());
            //var filterBy = "";

            $.ajax({
                type: "GET",
                url: link,
                contentType: 'application/json',
                cache: false,
                beforeSend: function () {
                    $('#btnUbahHJual').hide();
                    $('#loading_spinner_btn').show();
                },
                success: function (res) {
                    $('#btnUbahHJual').show();
                    $('#loading_spinner_btn').hide();
                    if (res.message == null) {
                        refreshTableHargaJual(filterBy);
                        alert("Harga jual berhasil diubah");
                        $('#table-hargaJual-partial').html(res);
                        //Initialize();

                        $('#modalEditHargaJual').modal('hide');
                    } else {
                        alert(res.message);
                    }

                },
                error: function (xhr) {
                    $('#btnUbahHJual').show();
                    $('#loading_spinner_btn').hide();
                    console.log(xhr);
                }
            });
        }

        function convertToRupiah(angka) {
            //change by calvin 26 september 2018
            //var rupiah = '';
            //var angkarev = angka.toString().split('').reverse().join('');
            //for (var i = 0; i < angkarev.length; i++) if (i % 3 === 0) rupiah += angkarev.substr(i, 3) + '.';
            //return rupiah.split('', rupiah.length - 1).reverse().join('') + ',00';
            return $.number(angka, 2, ',', '.');
            //end change by calvin 26 september 2018
        }

        function convertToAngka(rupiah) {

            if (rupiah == '') {
                rupiah = '0';
            }
            //change by calvin 26 september 2018
            //return parseInt(rupiah.replace(/,.*|[^0-9]/g, ''), 10);
            if (rupiah.includes(",")) {
                return parseFloat(rupiah.replaceAll('.', '').replaceAll(',', '.'));
            }
            else {
                //jika bisa desimal
                return parseFloat(rupiah.replaceAll(',', '.'));
            }
            //end change by calvin 26 september 2018
        }

        //add by nurul 13/6/2019
        function refreshTableHargaJual(filterBy) {
            var $link = '@Html.Raw(Url.Action("RefreshTableHargaJual", "Manage", new { page = "replaceLastPage", search = "replaceSearch", filter = "replaceFilter" }))';
            $link = $link.replace("replaceSearch", encodeURIComponent($('#search_hargaJual').val()));
            $link = $link.replace("replaceLastPage", encodeURIComponent($('#txt_last_page').val()));
            $link = $link.replace("replaceFilter", filterBy);

            $.ajax({
                type: "GET",
                url: $link,
                beforeSend: function () {
                    $('#table-hargaJual-partial').hide();
                    $('#loading_hargaJual_tab').show();
                },
                success: function (response) {
                    $('#table-hargaJual-partial').html(response);
                    $('#loading_hargaJual_tab').hide();
                    $('#table-hargaJual-partial').show();

                },
                error: function (xhr, status, error) {
                    console.log(error);
                }
            });
        }
        function searchTableHargaJual(filter){
            var $link = '@Html.Raw(Url.Action("RefreshTableHargaJual", "Manage", new { search = "replaceSearch", filter = "replaceFilter" }))';
            $link = $link.replace("replaceSearch", encodeURIComponent($('#search_hargaJual').val()));
            //add by fauzi tuning search harga jual
            $link = $link.replace("replaceFilter", filter);

            $.ajax({
                type: "GET",
                url: $link,
                beforeSend: function () {
                    $('#search_hargaJual_click')[0].disabled = true;
                    $('#loading_hargaJual_tab').show();
                },
                success: function (response) {
                    $('#search_hargaJual_click')[0].disabled = false;
                    $('#table-hargaJual-partial').html(response);
                    $('#loading_hargaJual_tab').hide();
                },
                error: function (xhr, status, error) {
                    $('#search_hargaJual_click')[0].disabled = false;
                    console.log(error);
                }
            });
        }
        //end add by nurul 13/6/2019

    </script>
}
